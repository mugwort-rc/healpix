#!/bin/sh
# ---------------------------------
# configuration file for previewing external codes used by Healpix 1.2 (essentially in IDL).
# Eric Hivon, Dec. 13, 2002
# updated echoLn for Darwin, March 11, 2004
# added display and open as default for Linux and Darwin respectively, Feb 11, 2005
#
#----------------------------------------------------
echoLn () {
    if [ "`uname -s`" = "Linux" -o "`uname -s`" = "Darwin" ]; then
	echo -n "$*"
    else
	echo "$*\c"
    fi
}
#----------------------------------------------------
setDefaults () {
    papersize="letter"
    media=" "
    ps_com="gv"
    gif_com="netscape"
    [ "`uname -s`" = "Linux" ]   && gif_com="display"
    [ "`uname -s`" = "Darwin" ]  && gif_com="open"
    HEALPIX=`pwd`
    previewfile=$HEALPIX/src/idl/visu/idl_default_previewer.pro
}

#----------------------------------------------------

askPaperSize () {
    echo
    echo "Please indicate what size of paper you will be mainly "
    echo "using for your Postscript printouts (eg: a4/letter)"
    echoLn "Enter choice [$papersize]       "
    read answer
    [ "x$answer" != "x" ] && papersize="$answer"
    echo "Note: the plot bounding box (BBox) rather than the paper size "
    echo "will be used when previewing a Postcript file"
}

#----------------------------------------------------

askPS () {
    echo
    echo  "Please indicate the Postscript previewer you want to use "
    echo  " (eg: gs, ghostview, gv, ggv, kghostview)"
    echoLn "Enter choice [$ps_com]        "
    read answer
    [ "x$answer" != "x" ] && ps_com="$answer"
    ngs=`$ps_com -v 2>&1 | grep -i ghostscript | wc -l`
    ngv=`$ps_com -v 2>&1 | grep -i gv | wc -l`
    nghostview=`echo $ps_com | grep -i ghostview | wc -l`

    if [ $ngs != 0 ] ; then
	ps_scom="gs"
    elif [ $ngv != 0 ] ; then
	ps_scom="gv"
    elif [ $nghostview != 0 ] ; then
	ps_scom="ghostview"
    else
	ps_scom=$ps_com
    fi
}
#----------------------------------------------------

askGif () {
    echo
    echo "Please indicate the program to be used to view "
    echo "the GIF and PNG files generated by Healpix (eg: display, open)"
    echo "Note that xv may not be able to deal with PNG files"
    echoLn "Enter choice [$gif_com]       "
    read answer
    [ "x$answer" != "x" ] && gif_com="$answer"
    nnet=`$gif_com -version 2>&1 | grep -i netscape | wc -l`

    if [ $nnet != 0 ] ; then
	gif_scom="netscape"
    else
	gif_scom=$gif_com
    fi
    
}

#----------------------------------------------------

generateFile () {
    echo
    echo "Generating $previewfile"
    cat <<EOF > $previewfile
; ----------------------------------------
;
; File generated automatically by $0
; in $HEALPIX
; on `date`
; Used by preview_file.pro
;
; ----------------------------------------
papersize = '$papersize'
media = '$media'
ps_com = '$ps_com'
ps_scom = '$ps_scom'
gif_com  = '$gif_com'
gif_scom = '$gif_scom'
settings = 'user'
;-----------------------------------------
EOF
}

#----------------------------------------------------

setDefaults
askPaperSize
askPS
askGif
generateFile

exit 0

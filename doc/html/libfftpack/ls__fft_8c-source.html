<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ls_fft.c Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>ls_fft.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of libfftpack.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  libfftpack is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  libfftpack is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with libfftpack; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> */</span>
00018 
00019 <span class="comment">/*</span>
00020 <span class="comment"> *  libfftpack is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00021 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00022 <span class="comment"> *  (DLR).</span>
00023 <span class="comment"> */</span>
00024 
00025 <span class="comment">/*</span>
00026 <span class="comment"> *  Copyright (C) 2005 Max-Planck-Society</span>
00027 <span class="comment"> *  \author Martin Reinecke</span>
00028 <span class="comment"> */</span>
00029 
00030 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00031 <span class="preprocessor">#include &lt;math.h&gt;</span>
00032 <span class="preprocessor">#include &lt;string.h&gt;</span>
00033 <span class="preprocessor">#include "bluestein.h"</span>
00034 <span class="preprocessor">#include "fftpack.h"</span>
00035 <span class="preprocessor">#include "<a class="code" href="ls__fft_8h.html">ls_fft.h</a>"</span>
00036 
<a name="l00037"></a><a class="code" href="group__fftgroup.html#a2">00037</a> <a class="code" href="group__fftgroup.html#a0">complex_plan</a> <a class="code" href="group__fftgroup.html#a2">make_complex_plan</a> (<span class="keywordtype">int</span> length)
00038   {
00039   <a class="code" href="group__fftgroup.html#a0">complex_plan</a> plan = (<a class="code" href="group__fftgroup.html#a0">complex_plan</a>) malloc(<span class="keyword">sizeof</span>(complex_plan_i));
00040   <span class="keywordtype">int</span> pfsum = prime_factor_sum(length);
00041   <span class="keywordtype">double</span> comp1 = length*pfsum;
00042   <span class="keywordtype">double</span> comp2 = 2*3*length*log(3.*length);
00043   plan-&gt;length=length;
00044   plan-&gt;bluestein = (comp2&lt;comp1);
00045   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00046     bluestein_i (length,&amp;(plan-&gt;work));
00047   <span class="keywordflow">else</span>
00048     {
00049     plan-&gt;work=(<span class="keywordtype">double</span> *)malloc((4*length+15)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00050     cffti(length, plan-&gt;work);
00051     }
00052   <span class="keywordflow">return</span> plan;
00053   }
00054 
<a name="l00055"></a><a class="code" href="group__fftgroup.html#a3">00055</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a3">kill_complex_plan</a> (<a class="code" href="group__fftgroup.html#a0">complex_plan</a> plan)
00056   {
00057   free(plan-&gt;work);
00058   free(plan);
00059   }
00060 
<a name="l00061"></a><a class="code" href="group__fftgroup.html#a4">00061</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a4">complex_plan_forward</a> (<a class="code" href="group__fftgroup.html#a0">complex_plan</a> plan, <span class="keywordtype">double</span> *data)
00062   {
00063   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00064     bluestein (plan-&gt;length, data, plan-&gt;work, -1);
00065   <span class="keywordflow">else</span>
00066     cfftf (plan-&gt;length, data, plan-&gt;work);
00067   }
00068 
<a name="l00069"></a><a class="code" href="group__fftgroup.html#a5">00069</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a5">complex_plan_backward</a> (<a class="code" href="group__fftgroup.html#a0">complex_plan</a> plan, <span class="keywordtype">double</span> *data)
00070   {
00071   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00072     bluestein (plan-&gt;length, data, plan-&gt;work, 1);
00073   <span class="keywordflow">else</span>
00074     cfftb (plan-&gt;length, data, plan-&gt;work);
00075   }
00076 
00077 
<a name="l00078"></a><a class="code" href="group__fftgroup.html#a6">00078</a> <a class="code" href="group__fftgroup.html#a1">real_plan</a> <a class="code" href="group__fftgroup.html#a6">make_real_plan</a> (<span class="keywordtype">int</span> length)
00079   {
00080   <a class="code" href="group__fftgroup.html#a1">real_plan</a> plan = (<a class="code" href="group__fftgroup.html#a1">real_plan</a>) malloc(<span class="keyword">sizeof</span>(real_plan_i));
00081   <span class="keywordtype">int</span> pfsum = prime_factor_sum(length);
00082   <span class="keywordtype">double</span> comp1 = .5*length*pfsum;
00083   <span class="keywordtype">double</span> comp2 = 2*3*length*log(3.*length);
00084   plan-&gt;length=length;
00085   plan-&gt;bluestein = (comp2&lt;comp1);
00086   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00087     bluestein_i (length,&amp;(plan-&gt;work));
00088   <span class="keywordflow">else</span>
00089     {
00090     plan-&gt;work=(<span class="keywordtype">double</span> *)malloc((2*length+15)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00091     rffti(length, plan-&gt;work);
00092     }
00093   <span class="keywordflow">return</span> plan;
00094   }
00095 
<a name="l00096"></a><a class="code" href="group__fftgroup.html#a7">00096</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a7">kill_real_plan</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan)
00097   {
00098   free(plan-&gt;work);
00099   free(plan);
00100   }
00101 
<a name="l00102"></a><a class="code" href="group__fftgroup.html#a8">00102</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a8">real_plan_forward_fftpack</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00103   {
00104   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00105     {
00106     <span class="keywordtype">int</span> m;
00107     <span class="keywordtype">int</span> n=plan-&gt;length;
00108     <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(2*n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00109     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m)
00110       {
00111       tmp[2*m] = data[m];
00112       tmp[2*m+1] = 0.;
00113       }
00114     bluestein(n,tmp,plan-&gt;work,-1);
00115     data[0] = tmp[0];
00116     memcpy (data+1, tmp+2, (n-1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00117     free (tmp);
00118     }
00119   <span class="keywordflow">else</span>
00120     rfftf (plan-&gt;length, data, plan-&gt;work);
00121   }
00122 
00123 <span class="keyword">static</span> <span class="keywordtype">void</span> fftpack2halfcomplex (<span class="keywordtype">double</span> *data, <span class="keywordtype">int</span> n)
00124   {
00125   <span class="keywordtype">int</span> m;
00126   <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00127   tmp[0]=data[0];
00128   <span class="keywordflow">for</span> (m=1; m&lt;(n+1)/2; ++m)
00129     {
00130     tmp[m]=data[2*m-1];
00131     tmp[n-m]=data[2*m];
00132     }
00133   <span class="keywordflow">if</span> (!(n&amp;1))
00134     tmp[n/2]=data[n-1];
00135   memcpy (data,tmp,n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00136   free(tmp);
00137   }
00138 
00139 <span class="keyword">static</span> <span class="keywordtype">void</span> halfcomplex2fftpack (<span class="keywordtype">double</span> *data, <span class="keywordtype">int</span> n)
00140   {
00141   <span class="keywordtype">int</span> m;
00142   <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00143   tmp[0]=data[0];
00144   <span class="keywordflow">for</span> (m=1; m&lt;(n+1)/2; ++m)
00145     {
00146     tmp[2*m-1]=data[m];
00147     tmp[2*m]=data[n-m];
00148     }
00149   <span class="keywordflow">if</span> (!(n&amp;1))
00150     tmp[n-1]=data[n/2];
00151   memcpy (data,tmp,n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00152   free(tmp);
00153   }
00154 
<a name="l00155"></a><a class="code" href="group__fftgroup.html#a10">00155</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a10">real_plan_forward_fftw</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00156   {
00157   <a class="code" href="group__fftgroup.html#a8">real_plan_forward_fftpack</a> (plan, data);
00158   fftpack2halfcomplex (data,plan-&gt;length);
00159   }
00160 
<a name="l00161"></a><a class="code" href="group__fftgroup.html#a9">00161</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a9">real_plan_backward_fftpack</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00162   {
00163   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00164     {
00165     <span class="keywordtype">int</span> m;
00166     <span class="keywordtype">int</span> n=plan-&gt;length;
00167     <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(2*n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00168     tmp[0]=data[0];
00169     tmp[1]=0.;
00170     memcpy (tmp+2,data+1, (n-1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00171     <span class="keywordflow">if</span> ((n&amp;1)==0) tmp[n+1]=0.;
00172     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00173       {
00174       tmp[2*n-m]=tmp[m];
00175       tmp[2*n-m+1]=-tmp[m+1];
00176       }
00177     bluestein (n, tmp, plan-&gt;work, 1);
00178     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m)
00179       data[m] = tmp[2*m];
00180     free (tmp);
00181     }
00182   <span class="keywordflow">else</span>
00183     rfftb (plan-&gt;length, data, plan-&gt;work);
00184   }
00185 
<a name="l00186"></a><a class="code" href="group__fftgroup.html#a11">00186</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a11">real_plan_backward_fftw</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00187   {
00188   halfcomplex2fftpack (data,plan-&gt;length);
00189   <a class="code" href="group__fftgroup.html#a9">real_plan_backward_fftpack</a> (plan, data);
00190   }
00191 
<a name="l00192"></a><a class="code" href="group__fftgroup.html#a12">00192</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a12">real_plan_forward_c</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00193   {
00194   <span class="keywordtype">int</span> m;
00195   <span class="keywordtype">int</span> n=plan-&gt;length;
00196 
00197   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00198     {
00199     <span class="keywordflow">for</span> (m=1; m&lt;2*n; m+=2)
00200       data[m]=0;
00201     bluestein (plan-&gt;length, data, plan-&gt;work, -1);
00202     data[1]=0;
00203     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00204       {
00205       <span class="keywordtype">double</span> avg;
00206       avg = 0.5*(data[2*n-m]+data[m]);
00207       data[2*n-m] = data[m] = avg;
00208       avg = 0.5*(data[2*n-m+1]-data[m+1]);
00209       data[2*n-m+1] = avg;
00210       data[m+1] = -avg;
00211       }
00212     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00213     }
00214   <span class="keywordflow">else</span>
00215     {
00216     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m) data[m+1] = data[2*m];
00217     rfftf (n, data+1, plan-&gt;work);
00218     data[0] = data[1];
00219     data[1] = 0;
00220     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00221       {
00222       data[2*n-m]   =  data[m];
00223       data[2*n-m+1] = -data[m+1];
00224       }
00225     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00226     }
00227   }
00228 
<a name="l00229"></a><a class="code" href="group__fftgroup.html#a13">00229</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#a13">real_plan_backward_c</a> (<a class="code" href="group__fftgroup.html#a1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00230   {
00231   <span class="keywordtype">int</span> m;
00232   <span class="keywordtype">int</span> n=plan-&gt;length;
00233 
00234   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00235     {
00236     data[1]=0;
00237     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00238       {
00239       <span class="keywordtype">double</span> avg;
00240       avg = 0.5*(data[2*n-m]+data[m]);
00241       data[2*n-m] = data[m] = avg;
00242       avg = 0.5*(data[2*n-m+1]-data[m+1]);
00243       data[2*n-m+1] = avg;
00244       data[m+1] = -avg;
00245       }
00246     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00247     bluestein (plan-&gt;length, data, plan-&gt;work, 1);
00248     <span class="keywordflow">for</span> (m=1; m&lt;2*n; m+=2)
00249       data[m]=0;
00250     }
00251   <span class="keywordflow">else</span>
00252     {
00253     data[1] = data[0];
00254     rfftb (n, data+1, plan-&gt;work);
00255     <span class="keywordflow">for</span> (m=n-1; m&gt;=0; --m)
00256       {
00257       data[2*m]   = data[m+1];
00258       data[2*m+1] = 0.;
00259       }
00260     }
00261   }
</pre></div><hr><address style="align: right;"><small>
Generated on Thu Feb 19 17:23:12 2009 for LevelS FFT library
</a> </small></address>
</body>
</html>

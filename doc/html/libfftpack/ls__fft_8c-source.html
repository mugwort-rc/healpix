<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LevelS FFT library: ls_fft.c Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">libfftpack</a></div>
<h1>ls_fft.c</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> *  Copyright (C) 2005 Max-Planck-Society</span>
00029 <span class="comment"> *  \author Martin Reinecke</span>
00030 <span class="comment"> */</span>
00031 
00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00033 <span class="preprocessor">#include &lt;math.h&gt;</span>
00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
00035 <span class="preprocessor">#include "bluestein.h"</span>
00036 <span class="preprocessor">#include "fftpack.h"</span>
00037 <span class="preprocessor">#include "<a class="code" href="ls__fft_8h.html">ls_fft.h</a>"</span>
00038 
<a name="l00039"></a><a class="code" href="group__fftgroup.html#ga2">00039</a> <a class="code" href="group__fftgroup.html#ga0">complex_plan</a> <a class="code" href="group__fftgroup.html#ga2">make_complex_plan</a> (<span class="keywordtype">int</span> length)
00040   {
00041   <a class="code" href="group__fftgroup.html#ga0">complex_plan</a> plan = (<a class="code" href="group__fftgroup.html#ga0">complex_plan</a>) malloc(<span class="keyword">sizeof</span>(complex_plan_i));
00042   <span class="keywordtype">int</span> pfsum = prime_factor_sum(length);
00043   <span class="keywordtype">double</span> comp1 = length*pfsum;
00044   <span class="keywordtype">double</span> comp2 = 2*3*length*log(3.*length);
00045   plan-&gt;length=length;
00046   plan-&gt;bluestein = (comp2&lt;comp1);
00047   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00048     bluestein_i (length,&amp;(plan-&gt;work));
00049   <span class="keywordflow">else</span>
00050     {
00051     plan-&gt;work=(<span class="keywordtype">double</span> *)malloc((4*length+15)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00052     cffti(length, plan-&gt;work);
00053     }
00054   <span class="keywordflow">return</span> plan;
00055   }
00056 
<a name="l00057"></a><a class="code" href="group__fftgroup.html#ga3">00057</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga3">kill_complex_plan</a> (<a class="code" href="group__fftgroup.html#ga0">complex_plan</a> plan)
00058   {
00059   free(plan-&gt;work);
00060   free(plan);
00061   }
00062 
<a name="l00063"></a><a class="code" href="group__fftgroup.html#ga4">00063</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga4">complex_plan_forward</a> (<a class="code" href="group__fftgroup.html#ga0">complex_plan</a> plan, <span class="keywordtype">double</span> *data)
00064   {
00065   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00066     bluestein (plan-&gt;length, data, plan-&gt;work, -1);
00067   <span class="keywordflow">else</span>
00068     cfftf (plan-&gt;length, data, plan-&gt;work);
00069   }
00070 
<a name="l00071"></a><a class="code" href="group__fftgroup.html#ga5">00071</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga5">complex_plan_backward</a> (<a class="code" href="group__fftgroup.html#ga0">complex_plan</a> plan, <span class="keywordtype">double</span> *data)
00072   {
00073   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00074     bluestein (plan-&gt;length, data, plan-&gt;work, 1);
00075   <span class="keywordflow">else</span>
00076     cfftb (plan-&gt;length, data, plan-&gt;work);
00077   }
00078 
00079 
<a name="l00080"></a><a class="code" href="group__fftgroup.html#ga6">00080</a> <a class="code" href="group__fftgroup.html#ga1">real_plan</a> <a class="code" href="group__fftgroup.html#ga6">make_real_plan</a> (<span class="keywordtype">int</span> length)
00081   {
00082   <a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan = (<a class="code" href="group__fftgroup.html#ga1">real_plan</a>) malloc(<span class="keyword">sizeof</span>(real_plan_i));
00083   <span class="keywordtype">int</span> pfsum = prime_factor_sum(length);
00084   <span class="keywordtype">double</span> comp1 = .5*length*pfsum;
00085   <span class="keywordtype">double</span> comp2 = 2*3*length*log(3.*length);
00086   plan-&gt;length=length;
00087   plan-&gt;bluestein = (comp2&lt;comp1);
00088   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00089     bluestein_i (length,&amp;(plan-&gt;work));
00090   <span class="keywordflow">else</span>
00091     {
00092     plan-&gt;work=(<span class="keywordtype">double</span> *)malloc((2*length+15)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00093     rffti(length, plan-&gt;work);
00094     }
00095   <span class="keywordflow">return</span> plan;
00096   }
00097 
<a name="l00098"></a><a class="code" href="group__fftgroup.html#ga7">00098</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga7">kill_real_plan</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan)
00099   {
00100   free(plan-&gt;work);
00101   free(plan);
00102   }
00103 
<a name="l00104"></a><a class="code" href="group__fftgroup.html#ga8">00104</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga8">real_plan_forward_fftpack</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00105   {
00106   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00107     {
00108     <span class="keywordtype">int</span> m;
00109     <span class="keywordtype">int</span> n=plan-&gt;length;
00110     <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(2*n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00111     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m)
00112       {
00113       tmp[2*m] = data[m];
00114       tmp[2*m+1] = 0.;
00115       }
00116     bluestein(n,tmp,plan-&gt;work,-1);
00117     data[0] = tmp[0];
00118     memcpy (data+1, tmp+2, (n-1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00119     free (tmp);
00120     }
00121   <span class="keywordflow">else</span>
00122     rfftf (plan-&gt;length, data, plan-&gt;work);
00123   }
00124 
00125 <span class="keyword">static</span> <span class="keywordtype">void</span> fftpack2halfcomplex (<span class="keywordtype">double</span> *data, <span class="keywordtype">int</span> n)
00126   {
00127   <span class="keywordtype">int</span> m;
00128   <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00129   tmp[0]=data[0];
00130   <span class="keywordflow">for</span> (m=1; m&lt;(n+1)/2; ++m)
00131     {
00132     tmp[m]=data[2*m-1];
00133     tmp[n-m]=data[2*m];
00134     }
00135   <span class="keywordflow">if</span> (!(n&amp;1))
00136     tmp[n/2]=data[n-1];
00137   memcpy (data,tmp,n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00138   free(tmp);
00139   }
00140 
00141 <span class="keyword">static</span> <span class="keywordtype">void</span> halfcomplex2fftpack (<span class="keywordtype">double</span> *data, <span class="keywordtype">int</span> n)
00142   {
00143   <span class="keywordtype">int</span> m;
00144   <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00145   tmp[0]=data[0];
00146   <span class="keywordflow">for</span> (m=1; m&lt;(n+1)/2; ++m)
00147     {
00148     tmp[2*m-1]=data[m];
00149     tmp[2*m]=data[n-m];
00150     }
00151   <span class="keywordflow">if</span> (!(n&amp;1))
00152     tmp[n-1]=data[n/2];
00153   memcpy (data,tmp,n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00154   free(tmp);
00155   }
00156 
<a name="l00157"></a><a class="code" href="group__fftgroup.html#ga10">00157</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga10">real_plan_forward_fftw</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00158   {
00159   <a class="code" href="group__fftgroup.html#ga8">real_plan_forward_fftpack</a> (plan, data);
00160   fftpack2halfcomplex (data,plan-&gt;length);
00161   }
00162 
<a name="l00163"></a><a class="code" href="group__fftgroup.html#ga9">00163</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga9">real_plan_backward_fftpack</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00164   {
00165   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00166     {
00167     <span class="keywordtype">int</span> m;
00168     <span class="keywordtype">int</span> n=plan-&gt;length;
00169     <span class="keywordtype">double</span> *tmp = (<span class="keywordtype">double</span> *)malloc(2*n*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00170     tmp[0]=data[0];
00171     tmp[1]=0.;
00172     memcpy (tmp+2,data+1, (n-1)*<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
00173     <span class="keywordflow">if</span> ((n&amp;1)==0) tmp[n+1]=0.;
00174     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00175       {
00176       tmp[2*n-m]=tmp[m];
00177       tmp[2*n-m+1]=-tmp[m+1];
00178       }
00179     bluestein (n, tmp, plan-&gt;work, 1);
00180     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m)
00181       data[m] = tmp[2*m];
00182     free (tmp);
00183     }
00184   <span class="keywordflow">else</span>
00185     rfftb (plan-&gt;length, data, plan-&gt;work);
00186   }
00187 
<a name="l00188"></a><a class="code" href="group__fftgroup.html#ga11">00188</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga11">real_plan_backward_fftw</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00189   {
00190   halfcomplex2fftpack (data,plan-&gt;length);
00191   <a class="code" href="group__fftgroup.html#ga9">real_plan_backward_fftpack</a> (plan, data);
00192   }
00193 
<a name="l00194"></a><a class="code" href="group__fftgroup.html#ga12">00194</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga12">real_plan_forward_c</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00195   {
00196   <span class="keywordtype">int</span> m;
00197   <span class="keywordtype">int</span> n=plan-&gt;length;
00198 
00199   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00200     {
00201     <span class="keywordflow">for</span> (m=1; m&lt;2*n; m+=2)
00202       data[m]=0;
00203     bluestein (plan-&gt;length, data, plan-&gt;work, -1);
00204     data[1]=0;
00205     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00206       {
00207       <span class="keywordtype">double</span> avg;
00208       avg = 0.5*(data[2*n-m]+data[m]);
00209       data[2*n-m] = data[m] = avg;
00210       avg = 0.5*(data[2*n-m+1]-data[m+1]);
00211       data[2*n-m+1] = avg;
00212       data[m+1] = -avg;
00213       }
00214     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00215     }
00216   <span class="keywordflow">else</span>
00217     {
00218     <span class="keywordflow">for</span> (m=0; m&lt;n; ++m) data[m+1] = data[2*m];
00219     rfftf (n, data+1, plan-&gt;work);
00220     data[0] = data[1];
00221     data[1] = 0;
00222     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00223       {
00224       data[2*n-m]   =  data[m];
00225       data[2*n-m+1] = -data[m+1];
00226       }
00227     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00228     }
00229   }
00230 
<a name="l00231"></a><a class="code" href="group__fftgroup.html#ga13">00231</a> <span class="keywordtype">void</span> <a class="code" href="group__fftgroup.html#ga13">real_plan_backward_c</a> (<a class="code" href="group__fftgroup.html#ga1">real_plan</a> plan, <span class="keywordtype">double</span> *data)
00232   {
00233   <span class="keywordtype">int</span> m;
00234   <span class="keywordtype">int</span> n=plan-&gt;length;
00235 
00236   <span class="keywordflow">if</span> (plan-&gt;bluestein)
00237     {
00238     data[1]=0;
00239     <span class="keywordflow">for</span> (m=2; m&lt;n; m+=2)
00240       {
00241       <span class="keywordtype">double</span> avg;
00242       avg = 0.5*(data[2*n-m]+data[m]);
00243       data[2*n-m] = data[m] = avg;
00244       avg = 0.5*(data[2*n-m+1]-data[m+1]);
00245       data[2*n-m+1] = avg;
00246       data[m+1] = -avg;
00247       }
00248     <span class="keywordflow">if</span> ((n&amp;1)==0) data[n+1] = 0.;
00249     bluestein (plan-&gt;length, data, plan-&gt;work, 1);
00250     <span class="keywordflow">for</span> (m=1; m&lt;2*n; m+=2)
00251       data[m]=0;
00252     }
00253   <span class="keywordflow">else</span>
00254     {
00255     data[1] = data[0];
00256     rfftb (n, data+1, plan-&gt;work);
00257     <span class="keywordflow">for</span> (m=n-1; m&gt;=0; --m)
00258       {
00259       data[2*m]   = data[m+1];
00260       data[2*m+1] = 0.;
00261       }
00262     }
00263   }
</pre></div><hr><address style="align: right;"><small>
Generated on Fri Jul 8 09:37:13 2005 for LevelS FFT library
</a> </small></address>
</body>
</html>

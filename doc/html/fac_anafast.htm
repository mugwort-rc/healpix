<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">

<!--Converted with LaTeX2HTML 2018.3 (Released July 19, 2018) -->
<HTML lang="EN">
<HEAD>
<TITLE>anafast</TITLE>
<META NAME="description" CONTENT="anafast">
<META NAME="keywords" CONTENT="facilities">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2018.3">
   <link rel='apple-touch-icon' sizes='180x180' href='images/favicons/apple-touch-icon.png?v=2017'>
   <link rel='icon' type='image/png' sizes='32x32' href='images/favicons/favicon-32x32.png?v=2017'>
   <link rel='icon' type='image/png' sizes='16x16' href='images/favicons/favicon-16x16.png?v=2017'>
   <link rel='manifest' href='images/favicons/manifest.json?v=2017'>
   <link rel='mask-icon' href='images/favicons/safari-pinned-tab.svg?v=2017' color='#5bbad5'>
   <link rel='shortcut icon' href='images/favicons/favicon.ico?v=2017'>
   <meta name='apple-mobile-web-app-title' content='HEALPix'>
   <meta name='application-name' content='HEALPix'>
   <meta name='msapplication-config' content='images/favicons/browserconfig.xml?v=2017'>
   <meta name='theme-color' content='#ffffff'>

<LINK REL="STYLESHEET" HREF="facilities.css">

<LINK REL="next" HREF="fac_hotspot.htm">
<LINK REL="previous" HREF="fac_alteralm.htm">
<LINK REL="next" HREF="fac_hotspot.htm">
</HEAD>

<body text="#000000" bgcolor="#FFFFFA">

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="fac_alteralm.htm">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A
 HREF="fac_HEALPix_F90_facilities.htm">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="fac_hotspot.htm">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A ID="tex2html117"
  HREF="fac_TABLE_CONTENTS.htm">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Previous:</B> <A
 HREF="fac_alteralm.htm">alteralm</A>

<B>Up:</B> <A
 HREF="fac_HEALPix_F90_facilities.htm">HEALPix/F90 facilities</A>

<B> Next:</B> <A
 HREF="fac_hotspot.htm">hotspot</A>
<B> Top:</B> <a href="main.htm">Main Page</a></DIV>
<!--End of Navigation Panel-->

<H1><A ID="SECTION600"></A>
<A ID="fac:anafast"></A>
<BR>
 
</H1>

<P>
<b><font size=+6><FONT COLOR="#CC0000">anafast</FONT></font></b><hr>
<H3>This program performs harmonic analysis of the <b>HEALPix</b> maps 
up to a user
specified maximum spherical harmonic order <!-- MATH
 $\ell_{\mathrm{max}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img25.png"
 ALT="$\ell_{\mathrm{max}}$"></SPAN>.
The integrals are computed on the whole sphere, unless the user 
chooses  a provided option 
to excise from the input map(s) a simple, constant latitude, symmetric cut, and/or
apply an arbitray cut read from an external file.
Scalar, or scalar and tensor, spherical harmonic coefficients are evaluated
from the map(s) if the input provides, respectively, only the temperature,
or temperature and polarisation maps.
The total operation count scales as 
<!-- MATH
 ${\cal {O}}(N_{\mathrm{pix}}^{1/2}\ell_{\mathrm{max}}^2 )$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 3.21ex; vertical-align: -0.91ex; " SRC="fac_img26.png"
 ALT="${\cal {O}}(N_{\mathrm{pix}}^{1/2}\ell_{\mathrm{max}}^2 )$"></SPAN>. 
<BR>Anafast reads one (two) file(s) containing the map(s) and produces 
a file containing the temperature auto- (or cross-) power spectrum
<SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img27.png"
 ALT="$C^{TT}_\ell$"></SPAN> and, if requested, 
also the polarisation power spectra <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img28.png"
 ALT="$C^{EE}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img29.png"
 ALT="$C^{BB}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img30.png"
 ALT="$C^{TE}_\ell$"></SPAN>,
<SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img31.png"
 ALT="$C^{TB}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img32.png"
 ALT="$C^{EB}_\ell$"></SPAN> (as well as  <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img33.png"
 ALT="$C^{ET}_\ell$"></SPAN>,
<SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img34.png"
 ALT="$C^{BT}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img35.png"
 ALT="$C^{BE}_\ell$"></SPAN> if two maps are provided).
The <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> coefficients computed during the execution also can be  
written to a (two) file(s) if requested. 
<BR>Anafast executes an approximate, discrete point-set quadrature on 
a sphere
sampled at the <b>HEALPix</b> pixel centers.
Spherical harmonic transforms are computed 
using recurrence relations for Legendre polynomials on co-latitude, 
<SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img36.png"
 ALT="$\theta$"></SPAN>, 
and  Fast Fourier Transforms on longitude, <SPAN CLASS="MATH"><IMG STYLE="height: 2.10ex; vertical-align: -0.55ex; " SRC="fac_img37.png"
 ALT="$\phi$"></SPAN>. 
<BR>
Anafast is provided with an option to use precomputed Legendre Polynomials;
please note that since version 2.20 this will most likely reduce performance
instead of increasing it. 
<BR>
Anafast permits two execution options 
which allow a significant improvement of accuracy of 
the approximate quadrature performed by this facility:
<BR><SPAN CLASS="MATH"><IMG STYLE="height: 0.93ex; vertical-align: -0.10ex; " SRC="fac_img38.png"
 ALT="$\bullet$"></SPAN> Improved analyses using either the provided ring weights, 
which correct the quadrature on iso-latitude rings, or pixel-based weights which 
improve the quadrature on every pixels, and/or  
<BR><SPAN CLASS="MATH"><IMG STYLE="height: 0.93ex; vertical-align: -0.10ex; " SRC="fac_img38.png"
 ALT="$\bullet$"></SPAN> An iterative scheme using in 
succession several backward and forward harmonic transforms 
of the maps.</H3>
Location in HEALPix directory tree: <a href="https://sourceforge.net/p/healpix/code/1005/tree/trunk/src/f90/anafast/anafast.f90"><b>src/f90/anafast/anafast.f90</b></a>&nbsp;  

<P>
<hr> 
<H1>RECOMMENDATIONS FOR USERS</H1> 
<blockquote>
Execution of <FONT COLOR="#CC0000">anafast</FONT> requires a user to specify the maximum 
spherical harmonic order <!-- MATH
 $\ell_{\mathrm{max}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img25.png"
 ALT="$\ell_{\mathrm{max}}$"></SPAN> up to which the harmonic 
decomposition of the input maps will be performed.
Since there are no formal limits on parameter
<!-- MATH
 $\ell_{\mathrm{max}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img25.png"
 ALT="$\ell_{\mathrm{max}}$"></SPAN> enforced by <FONT COLOR="#CC0000">anafast</FONT>, the user should make his/her choices
judiciously. 
Hereafter it is convenient to specify <!-- MATH
 $\ell_{\mathrm{max}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img25.png"
 ALT="$\ell_{\mathrm{max}}$"></SPAN> 
in terms of the <b>HEALPix</b> 
map resolution parameter <!-- MATH
 $N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><I>N</I><SUB>side</SUB></SPAN> (called <SPAN CLASS="MATH"><I>nsmax</I></SPAN> in some other contexts).
<br><br>If the function to be analysed is strictly  band-width
limited, or nearly band-width limited (as in the case of 
a Gaussian beam smoothed signal discretized at a rate of a few pixels
per beam area), it is  sufficient to run <FONT COLOR="#CC0000">anafast</FONT> with
<!-- MATH
 $\ell_{\mathrm{max}}\approx 2\cdot N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img39.png"
 ALT="$\ell_{\mathrm{max}}\approx 2\cdot N_{\mathrm{side}}$"></SPAN>, with a very good <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img24.png"
 ALT="$C_\ell$"></SPAN> 
error performance 
already in the raw (i.e. uncorrected quadrature) harmonic transform mode. 
If quadrature 
corrections are still desired in this case, it should be sufficient to use, at no
extra cost in execution time, the ring-weighted quadrature scheme. 
This is the recommended mode of operation of <FONT COLOR="#CC0000">anafast</FONT> for essentially
error and worry free typical applications, e.g. CPU-intensive 
Monte Carlo studies. 
<br><br>A new set of pixel-based quadrature weights was introduced in <b>HEALPix</b> 3.40.
Pre-computed to inforce a (near) ideal integration of the spherical harmonics <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img40.png"
 ALT="$Y_{\ell m}$"></SPAN> on the pixelized sphere (ie <!-- MATH
 $\frac{4\pi}{N_{\mathrm{pix}}} \sum_p w(p) Y_{\ell m}(p) = \sqrt{4 \pi} \delta_{\ell 0}\delta_{m 0}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 3.26ex; vertical-align: -1.34ex; " SRC="fac_img41.png"
 ALT="$\frac{4\pi}{N_{\mathrm{pix}}} \sum_p w(p) Y_{\ell m}(p) = \sqrt{4 \pi} \delta_{\ell 0}\delta_{m 0}$"></SPAN>)
for <!-- MATH
 $|m| \le \ell \le 3 N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.33ex; vertical-align: -0.68ex; " SRC="fac_img42.png"
 ALT="$\vert m\vert \le \ell \le 3 N_{\mathrm{side}}$"></SPAN>, they can be used to insure that the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> and <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img24.png"
 ALT="$C_\ell$"></SPAN> computed by <FONT COLOR="#CC0000">anafast</FONT> are perfectly accurate (almost to machine precision) without the need for iterations, 
but <SPAN  CLASS="textbf">only</SPAN> for band-width 
limited input signal with <!-- MATH
 $\ell_{\mathrm{max}}\le 1.5 N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img43.png"
 ALT="$\ell_{\mathrm{max}}\le 1.5 N_{\mathrm{side}}$"></SPAN>.
<br><br>If more aggressive attempts are undertaken to extract from a map 
the spectral coefficients at <!-- MATH
 $\ell > 2\cdot N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img44.png"
 ALT="$\ell &gt; 2\cdot N_{\mathrm{side}}$"></SPAN> (for example, as 
in a possible case of an attempt to analyse an existing map, which was 
irreversibly binned  at a suboptimal resolution) 
the following should be kept in mind:
<br><br><SPAN CLASS="MATH"><IMG STYLE="height: 0.93ex; vertical-align: -0.10ex; " SRC="fac_img38.png"
 ALT="$\bullet$"></SPAN> Spherical harmonics discretized using <b>HEALPix</b> 
(either sampled at
pixel centers, or avaraged over pixel areas) form a linearly independent
system up to <!-- MATH
 $\ell_{\mathrm{max}}= 3 \cdot N_{\mathrm{side}}-1$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img45.png"
 ALT="$\ell_{\mathrm{max}}= 3 \cdot N_{\mathrm{side}}-1$"></SPAN>. Hence, the functions which are
strictly band-width limited to <!-- MATH
 $\ell_{\mathrm{max}}= 3 \cdot N_{\mathrm{side}}- 1$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img45.png"
 ALT="$\ell_{\mathrm{max}}= 3 \cdot N_{\mathrm{side}}-1$"></SPAN> 
can be fully
spectrally resolved with <FONT COLOR="#CC0000">anafast</FONT>, albeit with integration errors
in the uncorrected quadrature mode, which grow up to 
<!-- MATH
 $\delta C_\ell \propto \epsilon \cdot C_\ell$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.10ex; vertical-align: -0.45ex; " SRC="fac_img46.png"
 ALT="$\delta C_\ell \propto \epsilon \cdot C_\ell$"></SPAN>, with <SPAN CLASS="MATH"><IMG STYLE="height: 1.57ex; vertical-align: -0.16ex; " SRC="fac_img47.png"
 ALT="$\epsilon &lt;0.1$"></SPAN>, 
at the highest values of <SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img5.png"
 ALT="$\ell$"></SPAN>. These integration  errors 
can be efficiently 
reduced
using <FONT COLOR="#CC0000">anafast</FONT> in the iterative mode. Although this <!-- MATH
 $\ell_{\mathrm{max}}$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img25.png"
 ALT="$\ell_{\mathrm{max}}$"></SPAN> range
-- <!-- MATH
 $2 \cdot N_{\mathrm{side}}< \ell_{\mathrm{max}}< 3 \cdot N_{\mathrm{side}}- 1$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img48.png"
 ALT="$2 \cdot N_{\mathrm{side}}&lt; \ell_{\mathrm{max}}&lt; 3 \cdot N_{\mathrm{side}}- 1$"></SPAN> -- is easily
manageable with <FONT COLOR="#CC0000">anafast</FONT> used on strictly band-width limited functions,
it should be used with caution in basic and automated applications, e.g.
Monte Carlo simulations.
<br><br><SPAN CLASS="MATH"><IMG STYLE="height: 0.93ex; vertical-align: -0.10ex; " SRC="fac_img38.png"
 ALT="$\bullet$"></SPAN> As with any discrete Fourier transform, <FONT COLOR="#CC0000">anafast</FONT> application to
functions which are not band-width limited results with aliasing
of power, which can not be remedied. If the particular case of interest
may result in such a band-width violation (i.e. there is significant power
in the function at <!-- MATH
 $\ell > 3 \cdot N_{\mathrm{side}}-1$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img49.png"
 ALT="$\ell &gt; 3 \cdot N_{\mathrm{side}}-1$"></SPAN>), the function should
be smoothed before the application of <FONT COLOR="#CC0000">anafast</FONT>, or discretized and
then analysed, on a refined <b>HEALPix</b> grid (with larger <!-- MATH
 $N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><I>N</I><SUB>side</SUB></SPAN>).
<br><br><SPAN CLASS="MATH"><IMG STYLE="height: 0.93ex; vertical-align: -0.10ex; " SRC="fac_img38.png"
 ALT="$\bullet$"></SPAN> REMEMBER: 
A peculiar property of the sphere, which usually surprises those 
whose intuition is built on experience with FFTs on a segment, or 
on a Euclidean 
</blockquote>
<blockquote>
multidimensional
domain, is the lack of 
a regular and uniform point-set at arbitrary resolution, 
and the resulting non-commutativity of the forward and
backward discrete Fourier transforms on nearly-uniform point-sets,
e.g. <b>HEALPix</b>. Hence,
as in any case of attempting an extreme application of an off-the-shelf
software, use caution and understand your problem well <I>before</I>
executing <FONT COLOR="#CC0000">anafast</FONT> under such circumstances!

</blockquote>

<P>
<hr><h1>FORMAT </h1><blockquote><h3>%
anafast [options] [parameter_file]
</h3></blockquote>

<P>
<hr><H1>COMMAND LINE OPTIONS</H1> 
  <DL COMPACT><DT>
<B><TT>-d</TT></B>
<DD><DT>
<B><TT>--double</TT></B>
<DD>double precision mode (see 
  <A HREF="fac_Using_HEALPix_Fortran_90_fa.htm#fac:subsec:ioprec">Notes on double/single precision modes</A>)
    <DT>
<B><TT>-s</TT></B>
<DD><DT>
<B><TT>--single</TT></B>
<DD>single precision mode (default)
  </DL>

<P>
<hr>
<H1>QUALIFIERS</H1>
 
  <DL COMPACT><DT>
<B>infile = </B>
<DD><A ID="fac:anafast:infile"></A>Defines the input map file. 
	(default= map.fits)
	If not blank, the filename should <EM>never</EM> be put between quotes even if it contains
symbols such as <TT>&amp;, [, ], ?, =</TT> which should be typed literally (ie, unprotected). For instance
 <TT>infile&nbsp;=&nbsp;http://site/action?file.fits[2][col FLUX]</TT> is just fine.
    <DT>
<B>infile2 = </B>
<DD><A ID="fac:anafast:infile2"></A>Defines the 2nd input map file, to be cross-correlated with
	the first one. The 2 maps should match in resolution (<!-- MATH
 $N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><I>N</I><SUB>side</SUB></SPAN>) and coordinate.
	(default= `', only the auto-correlation of the first map will be computed)
    <DT>
<B>outfile = </B>
<DD><A ID="fac:anafast:outfile"></A>Defines the output file with the power spectrum. If only
      one input map is provided, <TT>outfile</TT> will contains its auto-spectra,
      if 2 maps are provided, <TT>outfile</TT> will contain their
      cross-spectra. Note in particular that in the latter case, the <!-- MATH
 $C^{T\times E}_l$
 -->
<SPAN CLASS="MATH"><I>C</I><SUP><I>T</I> x <I>E</I></SUP><SUB><i>l</i></SUB></SPAN> power
      spectrum will be build from the <SPAN CLASS="MATH"><I>T</I></SPAN> field of the 1st (possibly polarized) map, and the <SPAN CLASS="MATH"><I>E</I></SPAN>
      field of the second polarized map.
(default= cl_out.fits)
     <DT>
<B>simul_type = </B>
<DD><A ID="fac:anafast:simul_type"></A>Defines which map(s) to analyse, 1=temperature only, 2=temperature AND polarisation.
(default= 1)
     <DT>
<B>nlmax = </B>
<DD><A ID="fac:anafast:nlmax"></A>Defines the maximum <SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img5.png"
 ALT="$\ell$"></SPAN> value 
to be used. See the Recommendations for Users. 
(default= 64)
 <DT>
<B>maskfile = </B>
<DD><A ID="fac:anafast:maskfile"></A>Defines the FITS file containing the pixel mask(s) or
 weighting scheme(s) by which the map(s) read from <TT>infile</TT> will be
 multiplied before analysis. If the file contains several fields, the first
one in which at least one pixel is non-zero will be used. This option can be
 used to, for instance, apply
the WMAP Kp intensity mask to the data (see
<A ID="tex2html17"
  HREF="https://lambda.gsfc.nasa.gov">https://lambda.gsfc.nasa.gov</A>), 
but it will <EM>not</EM> handle the WMAP composite mask correctly.
Can be used in conjonction with <TT>theta_cut_deg</TT>. Masked or weighted pixels

will be correctly accounted when performing the monopole and dipole regression.
<BR><EM>Note:</EM> The mask's resolution (<!-- MATH
 $N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><I>N</I><SUB>side</SUB></SPAN>) and ordering can be different from the input map(s)
one's, and the mask will be pro/down-graded and reordered to match the map. On the
other hand, the mask and maps coordinates will always be presumed to match (ie, no
attempt of rotation of the mask will be made).
(default= `': no mask, all valid pixels are used)
 <DT>
<B>theta_cut_deg = </B>
<DD><A ID="fac:anafast:theta_cut_deg"></A>Defines the latitude (in degrees) of 
an optional, straight symmetric cut around the equator.  Pixels located within
that cut (<SPAN CLASS="MATH">|b|&lt;</SPAN><TT>theta_cut_deg</TT>) are ignored.
(default= <SPAN CLASS="MATH"><IMG STYLE="height: 1.63ex; vertical-align: -0.10ex; " SRC="fac_img50.png"
 ALT="$0^\circ$"></SPAN>: no cut)
 <DT>
<B>iter_order = </B>
<DD><A ID="fac:anafast:iter_order"></A>Defines the maximum order of quadrature 
iteration to be used. (default=0, no iteration).
For details, see the <A HREF="./sub_map2alm_iterative.htm#sub:map2alm_iterative"><TT>map2alm_iterative</TT></A> routine
described in the <A ID="tex2html18"
  HREF="subroutines.htm">&rdquo;Fortran Subroutines&rdquo;</A>
document.
<A HREF="#fac:anafast:iter_order">iter_order</A><SPAN CLASS="MATH">&gt;0</SPAN> can <EM>not</EM> be used together with <A HREF="#fac:anafast:won">won</A>=2.
 <DT>
<B>outfile_alms = </B>
<DD><A ID="fac:anafast:outfile_alms"></A>Defines the name of the file 
containing the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> coefficients of the first map
which can be written optionally.   (default= no entry --
<SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN>s are not written to a file)
 <DT>
<B>outfile_alms2 = </B>
<DD><A ID="fac:anafast:outfile_alms2"></A>Defines the name of the file 
containing the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> coefficients of the second map, if any,
which can be written optionally.   (default= no entry --
<SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN>s are not written to a file)
 <DT>
<B>plmfile = </B>
<DD><A ID="fac:anafast:plmfile"></A>Defines the name for an input file
    containing  precomputed Legendre polynomials <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img51.png"
 ALT="$P_{\ell m}$"></SPAN>.
(default= no entry -- <FONT COLOR="#CC0000">anafast</FONT> executes the recursive evaluation 
of <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img51.png"
 ALT="$P_{\ell m}$"></SPAN>s)
<DT>
<B>w8file = </B>
<DD><A ID="fac:anafast:w8file"></A>Defines name for an input file containing ring-based or pixel-based
  weights (depending on the value of <A HREF="#fac:anafast:won">won</A>) in the improved quadrature mode (default= no entry --
see <A HREF="fac_Using_HEALPix_Fortran_90_fa.htm#fac:subsec:defdir">&rdquo;Default file names and directories&rdquo; in introduction</A>)
<DT>
<B>w8filedir = </B>
<DD><A ID="fac:anafast:w8filedir"></A>Gives the directory where the ring weight files are
to be found (default= no entry -- <FONT COLOR="#CC0000">anafast</FONT> searches the default
directories, see <A HREF="fac_Using_HEALPix_Fortran_90_fa.htm#fac:subsec:defdir">&rdquo;Default file names and directories&rdquo; in introduction</A>)
<DT>
<B>won = </B>
<DD><A ID="fac:anafast:won"></A>Set this to 1 if ring-based quadrature weight files are to be used,
 or to 2 to use pixel-based weight files instead;
otherwise set it to 0. (default= 0).
<A HREF="#fac:anafast:won">won</A>=2 can <EM>not</EM> be used together with <A HREF="#fac:anafast:iter_order">iter_order</A><SPAN CLASS="MATH">&gt;0</SPAN>.
<DT>
<B>regression = </B>
<DD><A ID="fac:anafast:regression"></A>Sets the degree of the regression made on the
input map before doing the power spectrum analysis. 
The regression is a minimal variance fit (assuming a uniform noise) 
made on valid (unflagged and unmasked) pixels, out of the symmetric cut (if
any). In case of cut sky analysis, such a regression reduces the monopole
and dipole leakage to higher <SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img5.png"
 ALT="$\ell$"></SPAN>'s.
<BR>
0 : no regression, does the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> analysis on the raw map
<BR>
1 : removes the best fit monopole first
<BR>
2 : removes the best fit monopole and dipole first
<BR>
default = 0.

<P>
</DL>

<P>
<hr> 
<H1>DESCRIPTION</H1> 
<blockquote>
Anafast reads one or two binary FITS-files containing a <b>HEALPix</b> map. These
files can each contain
a temperature map or both temperature and polarisation (Q,U) maps. Anafast analyses
the map(s) and makes an output ascii-FITS file containing the angular auto or cross
power spectra <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img27.png"
 ALT="$C^{TT}_\ell$"></SPAN>s
(and <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img28.png"
 ALT="$C^{EE}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img29.png"
 ALT="$C^{BB}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img30.png"
 ALT="$C^{TE}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img31.png"
 ALT="$C^{TB}_\ell$"></SPAN> and <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img32.png"
 ALT="$C^{EB}_\ell$"></SPAN> if specified, as well
as <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img33.png"
 ALT="$C^{ET}_\ell$"></SPAN>, <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img34.png"
 ALT="$C^{BT}_\ell$"></SPAN> and <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img35.png"
 ALT="$C^{BE}_\ell$"></SPAN> if two maps are provided). 
Here <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img30.png"
 ALT="$C^{TE}_\ell$"></SPAN> is meant as the power
spectrum built from the <SPAN CLASS="MATH"><I>T</I></SPAN> field of the first (polarized) map, and the <SPAN CLASS="MATH"><I>E</I></SPAN>
field of the second polarized map, while it is the other way around for <SPAN CLASS="MATH"><IMG STYLE="height: 2.51ex; vertical-align: -0.67ex; " SRC="fac_img33.png"
 ALT="$C^{ET}_\ell$"></SPAN>.
Anafast produces <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img24.png"
 ALT="$C_\ell$"></SPAN>s up to a specified maximum <SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img5.png"
 ALT="$\ell$"></SPAN>-value
(see Recommendations for Users). 
If requested, the computed <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> coefficients 
can  be written to a FITS file. This file can be used in the 
constrained realisation mode  of  <A HREF="fac_synfast.htm#fac:synfast">synfast</A>. 
<br><br>Anafast permits two execution modes that allow to improve 
the quadrature accuracy: 
(1) the  ring weight corrected quadrature, and
(2)  the  iterative scheme. 
Using the ring weights does not increase the execution time.  
The precomputed ring weights to be used for each 
<b>HEALPix</b> resolution <!-- MATH
 $N_{\mathrm{side}}$
 -->
<SPAN CLASS="MATH"><I>N</I><SUB>side</SUB></SPAN> are provided in
the <TT>$HEALPIX/data</TT> directory. 
The more sophisticated iterative scheme increases the
accuracy more effectively than the weighted ring scheme,
but its disadvantage is that the time for the analysis
increases, 1 iteration takes 3 times as long, 2 iterations 5 times as
long on so forth, since each order of iteration requires one more forward
and backward transform. 
<br><br>The spherical harmonics evaluation uses  a
recurrence on associated Legendre polynomials <!-- MATH
 $P_{\ell m}(\theta)$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.33ex; vertical-align: -0.68ex; " SRC="fac_img52.png"
 ALT="$P_{\ell m}(\theta)$"></SPAN>. 
This recurrence consumed most of the CPU time used by <FONT COLOR="#CC0000">anafast</FONT> up to version
2.15. We have therefore included an option to load precomputed values for the
<!-- MATH
 $P_{\ell m}(\theta)$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.33ex; vertical-align: -0.68ex; " SRC="fac_img52.png"
 ALT="$P_{\ell m}(\theta)$"></SPAN> from a file generated by the <b>HEALPix</b> facility
<A HREF="fac_plmgen.htm#fac:plmgen">plmgen</A>. Since the introduction of accelerated spherical
harmonic transforms in <b>HEALPix</b> v2.20, this feature is obsolete and should no
longer be used. 
<br><br>When dealing with polarized signal maps, the <FONT COLOR="#CC0000">anafast</FONT> behavior will depend on the value of the <SPAN  CLASS="texttt">POLCCONV</SPAN> FITS keyword
(see <A HREF="./intro_HEALPix_conventions.htm#intro:polcconv">note on POLCCONV</A> in <A ID="tex2html19"
  HREF="intro.htm">The <b>HEALPix</b> Primer</A>)
<br><br>In <A HREF="./sub_Changes_between_releases_3_.htm#sub:new3p50">version 3.50</A> a bug affecting previous versions of <FONT COLOR="#CC0000">anafast</FONT> has been fixed.
(It occured previously when 
<A HREF="#fac:anafast:iter_order"><SPAN  CLASS="texttt">iter_order</SPAN></A><SPAN CLASS="MATH">&gt;0</SPAN> 
was used in conjonction with a 
<A HREF="#fac:anafast:maskfile"><SPAN  CLASS="texttt">maskfile</SPAN></A> 
and/or a restrictive 
<A HREF="#fac:anafast:theta_cut_deg"><SPAN  CLASS="texttt">theta_cut_deg</SPAN></A>,
see <A HREF="./sub_map2alm_iterative.htm#sub:map2alm_iterative"><TT>map2alm_iterative</TT></A> for details). 
The result was correct when the mask (if any) was applied to the map prior to the 
<FONT COLOR="#CC0000">anafast</FONT> calling, or when no iteration was requested.
</blockquote>

<P>
<hr><H1>DATASETS</H1>
<h3>The following datasets are involved in the <b><FONT COLOR="#CC0000">anafast</FONT></b>
 processing.</h3>

<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT" VALIGN="TOP" WIDTH=150><SPAN  CLASS="textbf">Dataset</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=175><SPAN  CLASS="textbf">Description</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=150>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=150>
data/weight_ring_n0xxxx.fits</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>Files containing ring weights
                   for the <FONT COLOR="#CC0000">anafast</FONT> improved quadrature mode.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=150>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=150></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
</TABLE>

<P>
<hr><H1>SUPPORT    </H1><H3>This section lists those routines and facilities (including those <i>external</i> to the <b>HEALPix</b> distribution) which can assist in the utilisation of <b><FONT COLOR="#CC0000">anafast</FONT></b>.</H3>
  <DL COMPACT><DT>
<B><A HREF="fac_synfast.htm#fac:synfast">synfast</A></B>
<DD>This <b>HEALPix</b> facility can generate a map for analysis by <FONT COLOR="#CC0000">anafast</FONT>.
  <DT>
<B><A HREF="fac_alteralm.htm#fac:alteralm">alteralm</A></B>
<DD>This <b>HEALPix</b> Fortran facility can be
  used to modify the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> extracted by <FONT COLOR="#CC0000">anafast</FONT> before they are used as
  constraints on a <A HREF="fac_synfast.htm#fac:synfast">synfast</A> run.
  <DT>
<B><A HREF="fac_plmgen.htm#fac:plmgen">plmgen</A></B>
<DD>This <b>HEALPix</b> facility can be used to generate precomputed Legendre polynomials.		
  </DL>

<P>
<hr><H1>EXAMPLE # 1:</H1> 
<tt><TABLE CELLPADDING=3>
<TR><TD ALIGN="LEFT">anafast</TD>
<TD ALIGN="LEFT">&nbsp;</TD>
</TR>
</TABLE></tt>
<blockquote>
Anafast runs in interactive mode -- self-explanatory.
</blockquote>

<P>

<P>
<hr><H1>EXAMPLE # 2:</H1> 
<tt><TABLE CELLPADDING=3>
<TR><TD ALIGN="LEFT">anafast  filename</TD>
<TD ALIGN="LEFT">&nbsp;</TD>
</TR>
</TABLE></tt>
<blockquote>When 'filename' is present, <FONT COLOR="#CC0000">anafast</FONT> enters the non-interactive mode and parses
its inputs from the file 'filename'. This has the following
structure: the first entry is a qualifier which announces to the parser
which input immediately follows. If this input is omitted in the
input file, the parser assumes the default value.
If the equality sign is omitted, then the parser ignores the entry.
In this way comments may also be included in the file.
In this example, the file contains the following qualifiers:
<BR>
<tt><A HREF="#fac:anafast:simul_type">simul_type</A>= 1</tt><br>
<tt><A HREF="#fac:anafast:nlmax">nlmax</A>= 64</tt><br>
<tt><A HREF="#fac:anafast:theta_cut_deg">theta_cut_deg</A>= 0</tt><br>
<tt><A HREF="#fac:anafast:iter_order">iter_order</A>= 0</tt><br>
<tt><A HREF="#fac:anafast:infile">infile</A>= map.fits</tt><br>
<tt><A HREF="#fac:anafast:outfile">outfile</A>= cl_out.fits</tt><br>
<tt><A HREF="#fac:anafast:regression">regression</A>= 0</tt><br>
Anafast reads the map from <EM>map.fits</EM>, makes an analysis and produces <SPAN CLASS="MATH"><I>C</I><SUP><i>T</i></SUP><SUB><i>l</i></SUB></SPAN>s up to l=64.
This powerspectrum is saved in the file <EM>cl_out.fits</EM>. 
No galactic cut is excised and no iterations are performed.
As <A HREF="#fac:anafast:regression">regression</A>is set to 0 (its default value) the map is analyzed as
is, without prior best fit removal of the monopole nor the dipole.

<P>
Since
<BR>
<tt><A HREF="#fac:anafast:infile2">infile2</A></tt><br>
<tt><A HREF="#fac:anafast:outfile_alms">outfile_alms</A></tt><br>
<tt><A HREF="#fac:anafast:outfile_alms2">outfile_alms2</A></tt><br>
<tt><A HREF="#fac:anafast:w8file">w8file</A></tt><br>
<tt><A HREF="#fac:anafast:w8filedir">w8filedir</A></tt><br>
<tt><A HREF="#fac:anafast:plmfile">plmfile</A></tt><br>
<tt><A HREF="#fac:anafast:maskfile">maskfile</A></tt><br>
were omitted, they take their default values (empty strings). 
This means that no file for precomputed
Legendre polynomials is read, no second map is read, no mask is applied, and <FONT COLOR="#CC0000">anafast</FONT> does not save the <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN> values
from the analysis.

<P>
Also since
<BR>
<tt><A HREF="#fac:anafast:won">won</A></tt><br>
is not given, it takes its default value 0, which means that quadrature 
weights are not used.

<P>
</blockquote>

<P>
<hr><H1>RELEASE NOTES</H1><blockquote>
  <DL COMPACT><DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Initial release (<b>HEALPix</b> 0.90)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Optional non-interactive operation. Proper FITS file
    support. Improved reccurence algorithm for <!-- MATH
 $P_{\ell m}(\theta)$
 -->
<SPAN CLASS="MATH"><IMG STYLE="height: 2.33ex; vertical-align: -0.68ex; " SRC="fac_img52.png"
 ALT="$P_{\ell m}(\theta)$"></SPAN> which can compute to higher <SPAN CLASS="MATH"><IMG STYLE="height: 1.69ex; vertical-align: -0.10ex; " SRC="fac_img5.png"
 ALT="$\ell$"></SPAN> values. New functionality: arbitrary order of iterations, precomputed
    <SPAN CLASS="MATH"><IMG STYLE="height: 2.04ex; vertical-align: -0.45ex; " SRC="fac_img51.png"
 ALT="$P_{\ell m}$"></SPAN>, dumping of <SPAN CLASS="MATH"><IMG STYLE="height: 1.46ex; vertical-align: -0.45ex; " SRC="fac_img14.png"
 ALT="$a_{\ell m}$"></SPAN>. (<b>HEALPix</b> 1.00)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 New functionality: possibility of removing the best fit monopole
    and dipole. New Parser. Can be linked to FFTW (<b>HEALPix</b> 1.20)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 New functionality: addition of <TT>maskfile</TT> (<b>HEALPix</b> 2.0)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Bug correction: correct interaction of iterative scheme with masked pixels (<b>HEALPix</b> 2.01)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 New functionality: cross-correlation of 2 maps; Correction of this documentation: the code expects <TT>maskfile</TT> and
not <TT>mask_file</TT>  (<b>HEALPix</b> 2.1)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Bug correction: now correctly supports mask pro/down-grading
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Support for pixel-based quadrature weights when <A HREF="#fac:anafast:won"><SPAN  CLASS="texttt">won=2</SPAN></A> (<b>HEALPix</b> 3.40)
    <DT><DD><IMG WIDTH="14" HEIGHT="14" SRC="blueball.png" ALT="*">
 Correction of a bug in <A HREF="./sub_map2alm_iterative.htm#sub:map2alm_iterative"><TT>map2alm_iterative</TT></A> (<b>HEALPix</b> 3.50)
  </DL>
</blockquote>

<P>
<hr><H1>MESSAGES</H1><h3>This section describes error messages generated by <b><FONT COLOR="#CC0000">anafast</FONT></b>
</h3>

<TABLE CELLPADDING=3 BORDER="1">
<TR><TH ALIGN="LEFT" VALIGN="TOP" WIDTH=125><SPAN  CLASS="textbf">Message</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=50><SPAN  CLASS="textbf">Severity</SPAN></TH>
<TH ALIGN="LEFT" VALIGN="TOP" WIDTH=175><SPAN  CLASS="textbf">Text</SPAN></TH>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=125>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=50>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=125>
can not allocate memory for array xxx</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=50>Fatal</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>You do not have
                   sufficient system resources to run this
                   facility at the map resolution you required. 
  Try a lower map resolution.</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=125>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=50>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
<TR><TD ALIGN="LEFT" VALIGN="TOP" WIDTH=125></TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=50>&nbsp;</TD>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH=175>&nbsp;</TD>
</TR>
</TABLE>


<P>

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="fac_alteralm.htm">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A
 HREF="fac_HEALPix_F90_facilities.htm">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="fac_hotspot.htm">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A ID="tex2html117"
  HREF="fac_TABLE_CONTENTS.htm">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A>  
<BR>
<B> Previous:</B> <A
 HREF="fac_alteralm.htm">alteralm</A>

<B>Up:</B> <A
 HREF="fac_HEALPix_F90_facilities.htm">HEALPix/F90 facilities</A>

<B> Next:</B> <A
 HREF="fac_hotspot.htm">hotspot</A>
<B> Top:</B> <a href="main.htm">Main Page</a></DIV>
<!--End of Navigation Panel-->
<ADDRESS>
Version 3.50, 2018-12-10
</ADDRESS>
</BODY>
</HTML>

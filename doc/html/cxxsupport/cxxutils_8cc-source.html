<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>cxxutils.cc Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>cxxutils.cc</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> *  This file contains the implementation of various convenience functions</span>
00029 <span class="comment"> *  used by the Planck LevelS package.</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> *  Copyright (C) 2002, 2003, 2004, 2005, 2006, 2007 Max-Planck-Society</span>
00032 <span class="comment"> *  Authors: Martin Reinecke, Reinhard Hell</span>
00033 <span class="comment"> */</span>
00034 
00035 <span class="comment">// if we are using g++, check for version 3.0 or higher</span>
00036 <span class="preprocessor">#ifdef __GNUC__</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#if (__GNUC__&lt;3)</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#error your C++ compiler is too old. g++ version 3.0 or higher is required.</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="preprocessor">#include &lt;fstream&gt;</span>
00043 <span class="preprocessor">#include &lt;sstream&gt;</span>
00044 <span class="preprocessor">#include &lt;iostream&gt;</span>
00045 <span class="preprocessor">#include &lt;iomanip&gt;</span>
00046 <span class="preprocessor">#include &lt;string&gt;</span>
00047 <span class="preprocessor">#include &lt;cstdio&gt;</span>
00048 <span class="preprocessor">#include &lt;cctype&gt;</span>
00049 <span class="preprocessor">#include "<a class="code" href="cxxutils_8h.html">cxxutils.h</a>"</span>
00050 <span class="preprocessor">#include "datatypes.h"</span>
00051 <span class="preprocessor">#include "openmp_support.h"</span>
00052 
00053 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00054 
<a name="l00055"></a><a class="code" href="group__fileutilsgroup.html#a0">00055</a> <span class="keywordtype">bool</span> <a class="code" href="group__fileutilsgroup.html#a1">file_present</a> (<span class="keyword">const</span> string &amp;filename)
00056   {
00057   ifstream dummy(filename.c_str());
00058   <span class="keywordflow">return</span> dummy;
00059   }
00060 
<a name="l00061"></a><a class="code" href="group__assertgroup.html#a2">00061</a> <span class="keywordtype">void</span> <a class="code" href="group__assertgroup.html#a3">assert_present</a> (<span class="keyword">const</span> string &amp;filename)
00062   {
00063   <span class="keywordflow">if</span> (<a class="code" href="group__fileutilsgroup.html#a1">file_present</a>(filename)) <span class="keywordflow">return</span>;
00064   <span class="keywordflow">throw</span> Message_error (<span class="stringliteral">"Error: file "</span> + filename + <span class="stringliteral">" does not exist!"</span>);
00065   }
00066 
<a name="l00067"></a><a class="code" href="group__assertgroup.html#a4">00067</a> <span class="keywordtype">void</span> <a class="code" href="group__assertgroup.html#a5">assert_not_present</a> (<span class="keyword">const</span> string &amp;filename)
00068   {
00069   <span class="keywordflow">if</span> (!<a class="code" href="group__fileutilsgroup.html#a1">file_present</a>(filename)) <span class="keywordflow">return</span>;
00070   <span class="keywordflow">throw</span> Message_error (<span class="stringliteral">"Error: file "</span> + filename + <span class="stringliteral">" already exists!"</span>);
00071   }
00072 
<a name="l00073"></a><a class="code" href="group__fileutilsgroup.html#a2">00073</a> <span class="keywordtype">void</span> <a class="code" href="group__fileutilsgroup.html#a3">remove_file</a> (<span class="keyword">const</span> string &amp;filename)
00074   {
00075   remove (filename.c_str());
00076   }
00077 
<a name="l00078"></a><a class="code" href="group__stringutilsgroup.html#a0">00078</a> string <a class="code" href="group__stringutilsgroup.html#a1">trim</a> (<span class="keyword">const</span> string &amp;orig)
00079   {
00080   string::size_type p1=orig.find_first_not_of(<span class="stringliteral">" \t"</span>);
00081   <span class="keywordflow">if</span> (p1==string::npos) <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00082   string::size_type p2=orig.find_last_not_of(<span class="stringliteral">" \t"</span>);
00083   <span class="keywordflow">return</span> orig.substr(p1,p2-p1+1);
00084   }
00085 
<a name="l00086"></a><a class="code" href="group__stringutilsgroup.html#a2">00086</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> T &amp;x)
00087   {
00088   ostringstream strstrm;
00089   strstrm &lt;&lt; x;
00090   <span class="keywordflow">return</span> <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(strstrm.str());
00091   }
00092 
00093 <span class="keyword">template</span>&lt;&gt; string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;x)
00094   { <span class="keywordflow">return</span> x ? <span class="stringliteral">"T"</span> : <span class="stringliteral">"F"</span>; }
00095 <span class="keyword">template</span>&lt;&gt; string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> string &amp;x)
00096   { <span class="keywordflow">return</span> <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(x); }
00097 <span class="keyword">template</span>&lt;&gt; string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">float</span> &amp;x)
00098   {
00099   ostringstream strstrm;
00100   strstrm &lt;&lt; setprecision(8) &lt;&lt; x;
00101   <span class="keywordflow">return</span> <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(strstrm.str());
00102   }
00103 <span class="keyword">template</span>&lt;&gt; string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">double</span> &amp;x)
00104   {
00105   ostringstream strstrm;
00106   strstrm &lt;&lt; setprecision(16) &lt;&lt; x;
00107   <span class="keywordflow">return</span> <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(strstrm.str());
00108   }
00109 
00110 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">signed</span> <span class="keywordtype">char</span> &amp;x);
00111 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> &amp;x);
00112 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">short</span> &amp;x);
00113 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> &amp;x);
00114 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">int</span> &amp;x);
00115 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;x);
00116 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">long</span> &amp;x);
00117 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> &amp;x);
00118 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> &amp;x);
00119 <span class="keyword">template</span> string <a class="code" href="group__stringutilsgroup.html#a2">dataToString</a> (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> &amp;x);
00120 
<a name="l00121"></a><a class="code" href="group__stringutilsgroup.html#a8">00121</a> string <a class="code" href="group__stringutilsgroup.html#a8">intToString</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> width)
00122   {
00123   ostringstream strstrm;
00124   strstrm &lt;&lt; setw(width) &lt;&lt; setfill(<span class="charliteral">'0'</span>) &lt;&lt; x;
00125   <span class="keywordflow">return</span> <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(strstrm.str());
00126   }
00127 
<a name="l00128"></a><a class="code" href="group__stringutilsgroup.html#a9">00128</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, T &amp;value)
00129   {
00130   string error = string(<span class="stringliteral">"conversion error in stringToData&lt;"</span>)
00131                + type2typename&lt;T&gt;()
00132                +<span class="stringliteral">"&gt;(\""</span>+x+<span class="stringliteral">"\")"</span>;
00133   istringstream strstrm(x);
00134   strstrm &gt;&gt; value;
00135   <span class="keywordflow">if</span> (!strstrm)
00136     <span class="keywordflow">throw</span> Message_error(error);
00137 
00138   string rest;
00139   strstrm &gt;&gt; rest;
00140 <span class="comment">//  rest=trim(rest);</span>
00141   <span class="keywordflow">if</span> (rest.length()&gt;0) <span class="keywordflow">throw</span> Message_error(error);
00142   }
00143 
00144 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, string &amp;value)
00145   { value = <a class="code" href="group__stringutilsgroup.html#a1">trim</a>(x); }
00146 
00147 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">bool</span> &amp;value)
00148   {
00149   <span class="keywordflow">if</span> ( x==<span class="stringliteral">"F"</span> || x==<span class="stringliteral">"f"</span> || x==<span class="stringliteral">"n"</span> || x==<span class="stringliteral">"N"</span> || x==<span class="stringliteral">"false"</span> || x==<span class="stringliteral">".false."</span>
00150        || x==<span class="stringliteral">"FALSE"</span> || x==<span class="stringliteral">".FALSE."</span>)
00151     value=<span class="keyword">false</span>;
00152   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (x==<span class="stringliteral">"T"</span> || x==<span class="stringliteral">"t"</span> || x==<span class="stringliteral">"y"</span> || x==<span class="stringliteral">"Y"</span> || x==<span class="stringliteral">"true"</span> || x==<span class="stringliteral">".true."</span>
00153        || x==<span class="stringliteral">"TRUE"</span> || x==<span class="stringliteral">".TRUE."</span>)
00154     value=<span class="keyword">true</span>;
00155   <span class="keywordflow">else</span>
00156     {
00157     string error = string(<span class="stringliteral">"conversion error in stringToData&lt;bool&gt;(\""</span>)+x+<span class="stringliteral">"\")"</span>;
00158     <span class="keywordflow">throw</span> Message_error (error);
00159     }
00160   }
00161 
00162 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">signed</span> <span class="keywordtype">char</span> &amp;value);
00163 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> &amp;value);
00164 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">short</span> &amp;value);
00165 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> &amp;value);
00166 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">int</span> &amp;value);
00167 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;value);
00168 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">long</span> &amp;value);
00169 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> &amp;value);
00170 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">long</span> <span class="keywordtype">long</span> &amp;value);
00171 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> &amp;value);
00172 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">float</span> &amp;value);
00173 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a15">stringToData</a> (<span class="keyword">const</span> string &amp;x, <span class="keywordtype">double</span> &amp;value);
00174 
<a name="l00175"></a><a class="code" href="group__stringutilsgroup.html#a18">00175</a> <span class="keywordtype">bool</span> <a class="code" href="group__stringutilsgroup.html#a19">equal_nocase</a> (<span class="keyword">const</span> string &amp;a, <span class="keyword">const</span> string &amp;b)
00176   {
00177   <span class="keywordflow">if</span> (a.size()!=b.size()) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00178   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=0; m&lt;a.size(); ++m)
00179     <span class="keywordflow">if</span> (<a class="code" href="group__stringutilsgroup.html#a21">tolower</a>(a[m])!=<a class="code" href="group__stringutilsgroup.html#a21">tolower</a>(b[m])) <span class="keywordflow">return</span> <span class="keyword">false</span>;
00180   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00181   }
00182 
<a name="l00183"></a><a class="code" href="group__stringutilsgroup.html#a20">00183</a> string <a class="code" href="group__stringutilsgroup.html#a21">tolower</a>(<span class="keyword">const</span> string &amp;input)
00184   {
00185   string result=input;
00186   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=0; m&lt;result.size(); ++m)
00187     result[m]=char(<a class="code" href="group__stringutilsgroup.html#a21">tolower</a>(result[m]));
00188   <span class="keywordflow">return</span> result;
00189   }
00190 
00191 <span class="comment">// FIXME: this should be configurable from outside</span>
00192 <span class="preprocessor">#define SILENT</span>
00193 <span class="preprocessor"></span><span class="preprocessor">#ifdef SILENT</span>
00194 <span class="preprocessor"></span>
00195 <span class="keywordtype">void</span> announce_progress (<span class="keywordtype">int</span>, <span class="keywordtype">int</span>) {}
00196 <span class="keywordtype">void</span> announce_progress (<span class="keywordtype">double</span>, <span class="keywordtype">double</span>, <span class="keywordtype">double</span>) {}
00197 <span class="keywordtype">void</span> end_announce_progress () {}
00198 
00199 <span class="preprocessor">#else</span>
00200 <span class="preprocessor"></span>
00201 <span class="keywordtype">void</span> announce_progress (<span class="keywordtype">int</span> now, <span class="keywordtype">int</span> total)
00202   {
00203   <span class="keywordflow">if</span> ((now%(max(total/100,1)))==0)
00204     cout &lt;&lt; <span class="stringliteral">"\r "</span> &lt;&lt; setw(3) &lt;&lt; planck_nint ((now*100.)/total)
00205          &lt;&lt; <span class="stringliteral">"% done\r"</span> &lt;&lt; flush;
00206   }
00207 
00208 <span class="keywordtype">void</span> announce_progress (<span class="keywordtype">double</span> now, <span class="keywordtype">double</span> last, <span class="keywordtype">double</span> total)
00209   {
00210   <span class="keywordtype">int</span> lastpercent = int((last/total)*100),
00211       nowpercent  = int(( now/total)*100);
00212   <span class="keywordflow">if</span> (nowpercent&gt;lastpercent)
00213     cout &lt;&lt; <span class="stringliteral">"\r "</span> &lt;&lt; setw(3) &lt;&lt; nowpercent &lt;&lt; <span class="stringliteral">"% done\r"</span> &lt;&lt; flush;
00214   }
00215 
00216 <span class="keywordtype">void</span> end_announce_progress ()
00217   { cout &lt;&lt; endl; }
00218 
00219 <span class="preprocessor">#endif</span>
00220 <span class="preprocessor"></span>
00221 <span class="keyword">static</span> <span class="keywordtype">void</span> openmp_status()
00222   {
00223   <span class="keywordflow">if</span> (openmp_enabled())
00224     {
00225     cout &lt;&lt; <span class="stringliteral">"Application was compiled with OpenMP support,"</span> &lt;&lt; endl;
00226     <span class="keywordflow">if</span> (openmp_max_threads() == 1)
00227       cout &lt;&lt; <span class="stringliteral">"but running with one process only."</span> &lt;&lt; endl;
00228     <span class="keywordflow">else</span>
00229       cout &lt;&lt; <span class="stringliteral">"running with up to "</span> &lt;&lt; openmp_max_threads()
00230            &lt;&lt; <span class="stringliteral">" processes."</span> &lt;&lt; endl;
00231     }
00232   <span class="keywordflow">else</span>
00233     cout &lt;&lt; <span class="stringliteral">"Application was compiled without OpenMP support;"</span> &lt;&lt; endl
00234          &lt;&lt; <span class="stringliteral">"running in scalar mode."</span> &lt;&lt; endl;
00235   }
00236 
00237 <span class="keywordtype">void</span> <a class="code" href="cxxutils_8h.html#a36">announce</a> (<span class="keyword">const</span> string &amp;name)
00238   {
00239   cout &lt;&lt; endl &lt;&lt; <span class="stringliteral">"+-"</span>;
00240   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=0; m&lt;name.length(); ++m) cout &lt;&lt; <span class="stringliteral">"-"</span>;
00241   cout &lt;&lt; <span class="stringliteral">"-+"</span> &lt;&lt; endl;
00242   cout &lt;&lt; <span class="stringliteral">"| "</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">" |"</span> &lt;&lt; endl;
00243   cout &lt;&lt; <span class="stringliteral">"+-"</span>;
00244   <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> m=0; m&lt;name.length(); ++m) cout &lt;&lt; <span class="stringliteral">"-"</span>;
00245   cout &lt;&lt; <span class="stringliteral">"-+"</span> &lt;&lt; endl &lt;&lt; endl;
00246   openmp_status();
00247   cout &lt;&lt; endl;
00248   }
00249 
00250 <span class="keywordtype">void</span> <a class="code" href="cxxutils_8h.html#a37">module_startup</a> (<span class="keyword">const</span> string &amp;name, <span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> **,
00251   <span class="keywordtype">int</span> argc_expected, <span class="keyword">const</span> string &amp;argv_expected)
00252   {
00253   <a class="code" href="cxxutils_8h.html#a36">announce</a> (name);
00254   <span class="keywordflow">if</span> (argc==argc_expected) <span class="keywordflow">return</span>;
00255   cerr &lt;&lt; <span class="stringliteral">"Usage: "</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">" "</span> &lt;&lt; argv_expected &lt;&lt; endl;
00256   <span class="keywordflow">throw</span> Message_error();
00257   }
00258 
<a name="l00259"></a><a class="code" href="group__stringutilsgroup.html#a16">00259</a> <span class="keywordtype">void</span> <a class="code" href="group__stringutilsgroup.html#a17">parse_file</a> (<span class="keyword">const</span> string &amp;filename, map&lt;string,string&gt; &amp;dict)
00260   {
00261   <span class="keywordtype">int</span> lineno=0;
00262   dict.clear();
00263   ifstream inp(filename.c_str());
00264   <a class="code" href="group__assertgroup.html#a1">planck_assert</a> (inp,<span class="stringliteral">"Could not open parameter file "</span>+filename);
00265   <span class="keywordflow">while</span> (inp)
00266     {
00267     string line;
00268     getline(inp, line);
00269     ++lineno;
00270     <span class="comment">// remove potential carriage returns at the end of the line</span>
00271     line=line.substr(0,line.find_first_of(<span class="stringliteral">"\r"</span>));
00272     line=line.substr(0,line.find_first_of(<span class="stringliteral">"#"</span>));
00273     line=<a class="code" href="group__stringutilsgroup.html#a1">trim</a>(line);
00274     <span class="keywordflow">if</span> (line.size()&gt;0)
00275       {
00276       string::size_type eqpos=line.find(<span class="stringliteral">"="</span>);
00277       <span class="keywordflow">if</span> (eqpos!=string::npos)
00278         {
00279         string key=<a class="code" href="group__stringutilsgroup.html#a1">trim</a>(line.substr(0,eqpos)),
00280                value=<a class="code" href="group__stringutilsgroup.html#a1">trim</a>(line.substr(eqpos+1,string::npos));
00281         <span class="keywordflow">if</span> (key==<span class="stringliteral">""</span>)
00282           cerr &lt;&lt; <span class="stringliteral">"Warning: empty key in "</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">", line "</span>
00283                &lt;&lt; lineno &lt;&lt; endl;
00284         <span class="keywordflow">else</span>
00285           {
00286           <span class="keywordflow">if</span> (dict.find(key)!=dict.end())
00287             cerr &lt;&lt; <span class="stringliteral">"Warning: key "</span> &lt;&lt; key &lt;&lt; <span class="stringliteral">" multiply defined in "</span>
00288                  &lt;&lt; filename &lt;&lt; <span class="stringliteral">", line "</span> &lt;&lt; lineno &lt;&lt; endl;
00289           dict[key]=value;
00290           }
00291         }
00292       <span class="keywordflow">else</span>
00293         cerr &lt;&lt; <span class="stringliteral">"Warning: unrecognized format in "</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">", line "</span>
00294              &lt;&lt; lineno &lt;&lt; <span class="stringliteral">":\n"</span> &lt;&lt; line &lt;&lt; endl;
00295       }
00296     }
00297   }
</pre></div><hr><address style="align: right;"><small>
Generated on Thu Nov 13 18:48:49 2008 for LevelS C++ support library
</a> </small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LevelS C++ support library: fitshandle.cc Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">cxxsupport</a></div>
<h1>fitshandle.cc</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> *  This file contains the implementation of the FITS I/O helper class</span>
00029 <span class="comment"> *  used by the Planck LevelS package.</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> *  Copyright (C) 2002, 2003, 2004 Max-Planck-Society</span>
00032 <span class="comment"> *  Author: Martin Reinecke</span>
00033 <span class="comment"> */</span>
00034 
00035 <span class="preprocessor">#include &lt;iostream&gt;</span>
00036 <span class="preprocessor">#include &lt;string&gt;</span>
00037 <span class="preprocessor">#include &lt;sstream&gt;</span>
00038 <span class="preprocessor">#include &lt;vector&gt;</span>
00039 <span class="preprocessor">#include &lt;map&gt;</span>
00040 <span class="preprocessor">#include "fitsio.h"</span>
00041 <span class="preprocessor">#include "<a class="code" href="fitshandle_8h.html">fitshandle.h</a>"</span>
00042 <span class="preprocessor">#include "<a class="code" href="cxxutils_8h.html">cxxutils.h</a>"</span>
00043 
00044 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00045 
00046 string type2char (<span class="keywordtype">int</span> type)
00047   {
00048   <span class="keywordflow">if</span> (type==TFLOAT) <span class="keywordflow">return</span> <span class="stringliteral">"E"</span>;
00049   <span class="keywordflow">if</span> (type==TDOUBLE) <span class="keywordflow">return</span> <span class="stringliteral">"D"</span>;
00050   <span class="keywordflow">if</span> (type==TINT) <span class="keywordflow">return</span> <span class="stringliteral">"J"</span>;
00051   <span class="keywordflow">if</span> (type==TINT32BIT) <span class="keywordflow">return</span> <span class="stringliteral">"J"</span>;
00052   <span class="keywordflow">if</span> (type==TSTRING) <span class="keywordflow">return</span> <span class="stringliteral">"A"</span>;
00053   <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"wrong datatype in type2char()"</span>);
00054   }
00055 
00056 string type2asciiform (<span class="keywordtype">int</span> type)
00057   {
00058   <span class="keywordflow">if</span> (type==TFLOAT) <span class="keywordflow">return</span> <span class="stringliteral">"E14.7"</span>;
00059   <span class="keywordflow">if</span> (type==TDOUBLE) <span class="keywordflow">return</span> <span class="stringliteral">"E23.15"</span>;
00060   <span class="keywordflow">if</span> (type==TINT) <span class="keywordflow">return</span> <span class="stringliteral">"I11"</span>;
00061   <span class="keywordflow">if</span> (type==TINT32BIT) <span class="keywordflow">return</span> <span class="stringliteral">"I11"</span>;
00062   <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"wrong datatype in type2asciiform()"</span>);
00063   }
00064 
00065 <span class="keywordtype">void</span> fitshandle::check_errors()
00066   {
00067   <span class="keywordflow">if</span> (status==0) <span class="keywordflow">return</span>;
00068   <span class="keywordtype">char</span> msg[81];
00069   fits_get_errstatus (status, msg);
00070   cerr &lt;&lt; msg &lt;&lt; endl;
00071   <span class="keywordflow">while</span> (fits_read_errmsg(msg)) cerr &lt;&lt; msg &lt;&lt; endl;
00072   <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"FITS error"</span>);
00073   }
00074 
00075 <span class="keywordtype">void</span> fitshandle::clean_data()
00076   {
00077   <span class="keywordflow">if</span> (!fptr) <span class="keywordflow">return</span>;
00078   axes_.clear();
00079   columns_.clear();
00080   hdutype_=INVALID;
00081   bitpix_=INVALID;
00082   nrows_=0;
00083   }
00084 
00085 <span class="keywordtype">void</span> fitshandle::clean_all()
00086   {
00087   <span class="keywordflow">if</span> (!fptr) <span class="keywordflow">return</span>;
00088   clean_data();
00089   fits_close_file (fptr, &amp;status);
00090   check_errors();
00091   fptr=0;
00092   }
00093 
00094 <span class="keywordtype">void</span> fitshandle::init_image()
00095   {
00096   <span class="keywordtype">int</span> naxis;
00097   fits_get_img_type (fptr, &amp;bitpix_, &amp;status);
00098   fits_get_img_dim (fptr, &amp;naxis, &amp;status);
00099   check_errors();
00100   <a class="code" href="classarr.html">arr&lt;long&gt;</a> naxes(naxis);
00101   fits_get_img_size (fptr, naxis, naxes, &amp;status);
00102   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0; m&lt;naxis; ++m) axes_.push_back(naxes[naxis-m-1]);
00103   check_errors();
00104   }
00105 
00106 <span class="keywordtype">void</span> fitshandle::init_asciitab()
00107   {
00108   <span class="keywordtype">char</span> ttype[81], tunit[81], tform[81];
00109   <span class="keywordtype">int</span> ncol, typecode;
00110   fits_get_num_cols (fptr, &amp;ncol, &amp;status);
00111   fits_get_num_rows (fptr, &amp;nrows_, &amp;status);
00112   check_errors();
00113   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=ncol; ++m)
00114     {
00115     fits_get_acolparms (fptr, m, ttype, 0, tunit, tform,
00116                         0, 0, 0, 0, &amp;status);
00117     fits_ascii_tform (tform, &amp;typecode, 0,0, &amp;status);
00118     check_errors();
00119     columns_.push_back (<a class="code" href="classfitscolumn.html">fitscolumn</a> (ttype,tunit,1,typecode));
00120     }
00121   }
00122 
00123 <span class="keywordtype">void</span> fitshandle::init_bintab()
00124   {
00125   <span class="keywordtype">char</span> ttype[81], tunit[81], tform[81];
00126   <span class="keywordtype">long</span> repc;
00127   <span class="keywordtype">int</span> ncol, typecode;
00128   fits_get_num_cols (fptr, &amp;ncol, &amp;status);
00129   fits_get_num_rows (fptr, &amp;nrows_, &amp;status);
00130   check_errors();
00131   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=ncol; ++m)
00132     {
00133     fits_get_bcolparms (fptr, m, ttype, tunit, tform, &amp;repc,
00134                         0, 0, 0, 0, &amp;status);
00135     fits_binary_tform (tform, &amp;typecode, 0,0, &amp;status);
00136     check_errors();
00137     columns_.push_back (<a class="code" href="classfitscolumn.html">fitscolumn</a> (ttype,tunit,repc,typecode));
00138     }
00139   }
00140 
00141 <span class="keywordtype">void</span> fitshandle::init_data()
00142   {
00143   <span class="keywordflow">switch</span>(hdutype_)
00144     {
00145     <span class="keywordflow">case</span> IMAGE_HDU:
00146       init_image();
00147       <span class="keywordflow">break</span>;
00148     <span class="keywordflow">case</span> ASCII_TBL:
00149       init_asciitab();
00150       <span class="keywordflow">break</span>;
00151     <span class="keywordflow">case</span> BINARY_TBL:
00152       init_bintab();
00153       <span class="keywordflow">break</span>;
00154     <span class="keywordflow">default</span>:
00155       <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"init_data(): wrong HDU type"</span>);
00156       <span class="keywordflow">break</span>;
00157     }
00158   }
00159 
00160 <span class="keywordtype">void</span> fitshandle::read_col (<span class="keywordtype">int</span> colnum, <span class="keywordtype">void</span> *data, <span class="keywordtype">long</span> ndata, <span class="keywordtype">int</span> dtype,
00161   <span class="keywordtype">long</span> offset)
00162   {
00163   assert_table_hdu(<span class="stringliteral">"fitshandle::read_column()"</span>,colnum);
00164   <span class="keywordtype">long</span> repc = columns_[colnum-1].repcount();
00165   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (ndata&lt;=(repc*nrows_-offset),
00166                  <span class="stringliteral">"read_column(): array too large"</span>);
00167   <span class="keywordtype">long</span> frow = offset/repc+1;
00168   <span class="keywordtype">long</span> felem = offset%repc+1;
00169   fits_read_col (fptr, dtype, colnum, frow, felem, ndata, 0, data, 0, &amp;status);
00170   check_errors();
00171   }
00172 <span class="keywordtype">void</span> fitshandle::write_col (<span class="keywordtype">int</span> colnum, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">long</span> ndata,
00173   <span class="keywordtype">int</span> dtype, <span class="keywordtype">long</span> offset)
00174   {
00175   assert_table_hdu(<span class="stringliteral">"fitshandle::write_column()"</span>,colnum);
00176   <span class="keywordtype">long</span> repc = columns_[colnum-1].repcount();
00177   <span class="keywordtype">long</span> frow = offset/repc+1;
00178   <span class="keywordtype">long</span> felem = offset%repc+1;
00179   fits_write_col (fptr, dtype, colnum, frow, felem, ndata,
00180     const_cast&lt;void *&gt;(data), &amp;status);
00181   fits_get_num_rows (fptr, &amp;nrows_, &amp;status);
00182   check_errors();
00183   }
00184 
<a name="l00185"></a><a class="code" href="classfitshandle.html#z1_4">00185</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_4">fitshandle::open</a> (<span class="keyword">const</span> string &amp;fname, <span class="keywordtype">int</span> rwmode)
00186   {
00187   clean_all();
00188   fits_open_file(&amp;fptr, fname.c_str(), rwmode, &amp;status);
00189   check_errors();
00190   }
00191 
<a name="l00192"></a><a class="code" href="classfitshandle.html#z1_5">00192</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_5">fitshandle::create</a> (<span class="keyword">const</span> string &amp;fname)
00193   {
00194   clean_all();
00195   fits_create_file(&amp;fptr, fname.c_str(), &amp;status);
00196   fits_write_imghdr(fptr, 8, 0, 0, &amp;status); <span class="comment">// insert empty PHDU</span>
00197   fits_write_date(fptr, &amp;status);
00198   check_errors();
00199   }
00200 
<a name="l00201"></a><a class="code" href="classfitshandle.html#z1_7">00201</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_7">fitshandle::goto_hdu</a> (<span class="keywordtype">int</span> hdu)
00202   {
00203   clean_data();
00204   fits_movabs_hdu(fptr, hdu, &amp;hdutype_, &amp;status);
00205   check_errors();
00206   init_data();
00207   }
00208 
<a name="l00209"></a><a class="code" href="classfitshandle.html#z1_9">00209</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_9">fitshandle::insert_bintab</a> (<span class="keyword">const</span> vector&lt;fitscolumn&gt; &amp;cols)
00210   {
00211   clean_data();
00212   <span class="keywordtype">int</span> ncol=cols.size();
00213   <a class="code" href="classarr2b.html">arr2b&lt;char&gt;</a> ttype(ncol,81), tform(ncol,81), tunit(ncol,81);
00214 
00215   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0; m&lt;ncol; ++m)
00216     {
00217     strcpy (ttype[m], cols[m].name().c_str());
00218     strcpy (tunit[m], cols[m].unit().c_str());
00219     ostringstream x;
00220     x &lt;&lt; cols[m].repcount() &lt;&lt; type2char (cols[m].type());
00221     strcpy (tform[m], x.str().c_str());
00222     }
00223   fits_insert_btbl (fptr, nrows_, ncol, ttype, tform, tunit,
00224     const_cast&lt;char *&gt;(<span class="stringliteral">"xtension"</span>), 0, &amp;status);
00225   check_errors();
00226   hdutype_=BINARY_TBL;
00227   columns_=cols;
00228   }
00229 
<a name="l00230"></a><a class="code" href="classfitshandle.html#z1_10">00230</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_10">fitshandle::insert_asctab</a> (<span class="keyword">const</span> vector&lt;fitscolumn&gt; &amp;cols)
00231   {
00232   clean_data();
00233   <span class="keywordtype">int</span> ncol=cols.size();
00234   <a class="code" href="classarr2b.html">arr2b&lt;char&gt;</a> ttype(ncol,81), tform(ncol,81), tunit(ncol,81);
00235 
00236   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0; m&lt;ncol; ++m)
00237     {
00238     strcpy (ttype[m], cols[m].name().c_str());
00239     strcpy (tunit[m], cols[m].unit().c_str());
00240     ostringstream x;
00241     <span class="keywordflow">if</span> (cols[m].type()!=TSTRING)
00242       {
00243       <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (cols[m].<a class="code" href="classfitshandle.html#z3_5">repcount</a>()==1,<span class="stringliteral">"bad repcount for ASCII table"</span>);
00244       x &lt;&lt; type2asciiform (cols[m].type());
00245       }
00246     <span class="keywordflow">else</span>
00247       {
00248       x &lt;&lt; <span class="stringliteral">"A"</span> &lt;&lt; <a class="code" href="group__stringutilsgroup.html#ga1">dataToString</a>(cols[m].<a class="code" href="classfitshandle.html#z3_5">repcount</a>());
00249       }
00250     strcpy (tform[m], x.str().c_str());
00251     }
00252   fits_insert_atbl (fptr, 0, nrows_, ncol, ttype, 0, tform, tunit,
00253     const_cast&lt;char *&gt;(<span class="stringliteral">"xtension"</span>), &amp;status);
00254   check_errors();
00255   hdutype_=ASCII_TBL;
00256   columns_=cols;
00257   }
00258 
<a name="l00259"></a><a class="code" href="classfitshandle.html#z1_11">00259</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_11">fitshandle::insert_image</a> (<span class="keywordtype">int</span> btpx, <span class="keyword">const</span> vector&lt;long&gt; &amp;Axes)
00260   {
00261   clean_data();
00262   hdutype_=IMAGE_HDU;
00263   bitpix_=btpx;
00264   axes_=Axes;
00265   <a class="code" href="classarr.html">arr&lt;long&gt;</a> tmpax(Axes.size());
00266   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0; m&lt;long(Axes.size()); m++) tmpax[m]=Axes[Axes.size()-1-m];
00267   fits_insert_img (fptr, btpx, Axes.size(), tmpax, &amp;status);
00268   check_errors();
00269   }
00270 
00271 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00272"></a><a class="code" href="classfitshandle.html#z1_12">00272</a>   <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_11">fitshandle::insert_image</a> (<span class="keywordtype">int</span> btpx, <span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;T&gt;</a> &amp;data)
00273   {
00274   clean_data();
00275   hdutype_=IMAGE_HDU;
00276   bitpix_=btpx;
00277   axes_.push_back(data.<a class="code" href="classarr2.html#a4">size1</a>());
00278   axes_.push_back(data.<a class="code" href="classarr2.html#a5">size2</a>());
00279   <a class="code" href="classarr.html">arr&lt;long&gt;</a> tmpax(axes_.size());
00280   <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0; m&lt;long(axes_.size()); m++) tmpax[m]=axes_[axes_.size()-1-m];
00281   fits_insert_img (fptr, btpx, axes_.size(), tmpax, &amp;status);
00282   <a class="code" href="classarr2.html">arr2&lt;T&gt;</a> &amp;tmparr = const_cast&lt;arr2&lt;T&gt; &amp;&gt; (data);
00283   fits_write_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, 1, axes_[0]*axes_[1],
00284     &amp;tmparr[0][0], &amp;status);
00285   check_errors();
00286   }
00287 
00288 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_11">fitshandle::insert_image</a> (<span class="keywordtype">int</span> btpx, <span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;double&gt;</a> &amp;data);
00289 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_11">fitshandle::insert_image</a> (<span class="keywordtype">int</span> btpx, <span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;float&gt;</a> &amp;data);
00290 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_11">fitshandle::insert_image</a> (<span class="keywordtype">int</span> btpx, <span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;int&gt;</a> &amp;data);
00291 
<a name="l00292"></a><a class="code" href="classfitshandle.html#z5_1">00292</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_1">fitshandle::copy_historified_header</a> (<span class="keyword">const</span> <a class="code" href="classfitshandle.html">fitshandle</a> &amp;orig)
00293   {
00294   <span class="keyword">const</span> <span class="keywordtype">char</span> *inclist[] = { <span class="stringliteral">"*"</span> };
00295   <span class="keyword">const</span> <span class="keywordtype">char</span> *exclist[] = {
00296       <span class="stringliteral">"SIMPLE"</span>,<span class="stringliteral">"BITPIX"</span>,<span class="stringliteral">"NAXIS"</span>,<span class="stringliteral">"NAXIS#"</span>,<span class="stringliteral">"PCOUNT"</span>,<span class="stringliteral">"GCOUNT"</span>,
00297       <span class="stringliteral">"EXTEND"</span>,<span class="stringliteral">"ORIGIN"</span>,<span class="stringliteral">"DATE*"</span>,<span class="stringliteral">"TFIELDS"</span>,<span class="stringliteral">"TTYPE#"</span>,<span class="stringliteral">"TFORM#"</span>,
00298       <span class="stringliteral">"TUNIT#"</span>,<span class="stringliteral">"EXTNAME"</span>,<span class="stringliteral">"CTYPE#"</span>,<span class="stringliteral">"CRVAL#"</span>,<span class="stringliteral">"CRPIX#"</span>,<span class="stringliteral">"CDELT#"</span>,
00299       <span class="stringliteral">"XTENSION"</span>,<span class="stringliteral">"INSTRUME"</span>,<span class="stringliteral">"TELESCOP"</span>,<span class="stringliteral">"PDMTYPE"</span>,<span class="stringliteral">"TBCOL#"</span> };
00300   <span class="keywordtype">char</span> card[81];
00301   string card2;
00302   orig.<a class="code" href="classfitshandle.html#d3">assert_connected</a>(<span class="stringliteral">"fitshandle::copy_historified_header()"</span>);
00303   assert_connected(<span class="stringliteral">"fitshandle::copy_historified_header()"</span>);
00304   fits_read_record (orig.<a class="code" href="classfitshandle.html#r1">fptr</a>, 0, card, &amp;status);
00305   check_errors();
00306   <span class="keywordflow">while</span> (<span class="keyword">true</span>)
00307     {
00308     fits_find_nextkey (orig.<a class="code" href="classfitshandle.html#r1">fptr</a>, const_cast&lt;char **&gt;(inclist), 1,
00309       const_cast&lt;char **&gt;(exclist), 23, card, &amp;status);
00310     <span class="keywordflow">if</span> (status!=0) <span class="keywordflow">break</span>;
00311     card2=<a class="code" href="group__stringutilsgroup.html#ga0">trim</a>(card);
00312     <span class="keywordflow">if</span> (card2!=<span class="stringliteral">"END"</span> &amp;&amp; card2!=<span class="stringliteral">"COMMENT"</span> &amp;&amp; card2!=<span class="stringliteral">"HISTORY"</span>)
00313       {
00314       <span class="keywordflow">if</span> (card2.find(<span class="stringliteral">"COMMENT"</span>)==0)
00315         card2.replace(0,7,<span class="stringliteral">"HISTORY"</span>);
00316       <span class="keywordflow">if</span> (card2.find(<span class="stringliteral">"HISTORY"</span>)!=0)
00317         card2.insert(0,<span class="stringliteral">"HISTORY "</span>);
00318       <span class="keywordflow">if</span> (card2.length()&lt;=80)
00319         fits_write_record (fptr, card2.c_str(), &amp;status);
00320       <span class="keywordflow">else</span>
00321         {
00322         fits_write_record (fptr, card2.substr(0,80).c_str(), &amp;status);
00323         card2=card2.substr(80,string::npos);
00324         card2.insert(0,<span class="stringliteral">"HISTORY "</span>);
00325         fits_write_record (fptr, card2.c_str(),&amp;status);
00326         }
00327       }
00328     check_errors();
00329     }
00330   <span class="keywordflow">if</span> (status==KEY_NO_EXIST) { fits_clear_errmsg(); status=0; }
00331   check_errors();
00332   }
00333 
<a name="l00334"></a><a class="code" href="classfitshandle.html#z5_0">00334</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_0">fitshandle::copy_header</a> (<span class="keyword">const</span> <a class="code" href="classfitshandle.html">fitshandle</a> &amp;orig)
00335   {
00336   <span class="keyword">const</span> <span class="keywordtype">char</span> *inclist[] = { <span class="stringliteral">"*"</span> };
00337   <span class="keyword">const</span> <span class="keywordtype">char</span> *exclist[] = {
00338       <span class="stringliteral">"SIMPLE"</span>,<span class="stringliteral">"BITPIX"</span>,<span class="stringliteral">"NAXIS"</span>,<span class="stringliteral">"NAXIS#"</span>,<span class="stringliteral">"PCOUNT"</span>,<span class="stringliteral">"GCOUNT"</span>,
00339       <span class="stringliteral">"EXTEND"</span>,<span class="stringliteral">"ORIGIN"</span>,<span class="stringliteral">"DATE*"</span>,<span class="stringliteral">"TFIELDS"</span>,<span class="stringliteral">"TTYPE#"</span>,<span class="stringliteral">"TFORM#"</span>,
00340       <span class="stringliteral">"TUNIT#"</span>,<span class="stringliteral">"EXTNAME"</span>,<span class="stringliteral">"CTYPE#"</span>,<span class="stringliteral">"CRVAL#"</span>,<span class="stringliteral">"CRPIX#"</span>,<span class="stringliteral">"CDELT#"</span>,
00341       <span class="stringliteral">"XTENSION"</span>,<span class="stringliteral">"INSTRUME"</span>,<span class="stringliteral">"TELESCOP"</span>,<span class="stringliteral">"PDMTYPE"</span>,<span class="stringliteral">"TBCOL#"</span> };
00342   <span class="keywordtype">char</span> card[81];
00343   string card2;
00344   orig.<a class="code" href="classfitshandle.html#d3">assert_connected</a>(<span class="stringliteral">"fitshandle::copy_header()"</span>);
00345   assert_connected(<span class="stringliteral">"fitshandle::copy_header()"</span>);
00346   fits_read_record (orig.<a class="code" href="classfitshandle.html#r1">fptr</a>, 0, card, &amp;status);
00347   check_errors();
00348   <span class="keywordflow">while</span> (<span class="keyword">true</span>)
00349     {
00350     fits_find_nextkey (orig.<a class="code" href="classfitshandle.html#r1">fptr</a>, const_cast&lt;char **&gt;(inclist), 1,
00351       const_cast&lt;char **&gt;(exclist), 23, card, &amp;status);
00352     <span class="keywordflow">if</span> (status!=0) <span class="keywordflow">break</span>;
00353     card2=<a class="code" href="group__stringutilsgroup.html#ga0">trim</a>(card);
00354     <span class="keywordflow">if</span> (card2!=<span class="stringliteral">"END"</span> &amp;&amp; card2!=<span class="stringliteral">"COMMENT"</span> &amp;&amp; card2!=<span class="stringliteral">"HISTORY"</span>)
00355       fits_write_record (fptr, card, &amp;status);
00356     check_errors();
00357     }
00358   <span class="keywordflow">if</span> (status==KEY_NO_EXIST) { fits_clear_errmsg(); status=0; }
00359   check_errors();
00360   }
00361 
00362 <span class="keywordtype">void</span> fitshandle::check_key_present(<span class="keyword">const</span> string &amp;name)
00363   {
00364   <span class="keywordtype">char</span> card[81];
00365   fits_read_card(fptr, const_cast&lt;char *&gt;(name.c_str()), card, &amp;status);
00366   <span class="keywordflow">if</span> (status==KEY_NO_EXIST)
00367     { fits_clear_errmsg(); status=0; <span class="keywordflow">return</span>; }
00368   check_errors();
00369 <span class="comment">// FIXME: disabled for now; but this issue needs to be resolved!</span>
00370 <span class="comment">//  cerr &lt;&lt; "Warning: key " &lt;&lt; name &lt;&lt; " set more than once!" &lt;&lt; endl;</span>
00371   }
00372 
<a name="l00373"></a><a class="code" href="classfitshandle.html#z5_2">00373</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a> (<span class="keyword">const</span> string &amp;name,
00374   <span class="keyword">const</span> T &amp;value, <span class="keyword">const</span> string &amp;comment)
00375   {
00376   assert_connected(<span class="stringliteral">"fitshandle::add_key()"</span>);
00377   check_key_present (name);
00378   fits_write_key (fptr, FITSUTIL&lt;T&gt;::DTYPE, const_cast&lt;char *&gt;(name.c_str()),
00379     const_cast&lt;T *&gt;(&amp;value), const_cast&lt;char *&gt;(comment.c_str()), &amp;status);
00380   check_errors();
00381   }
00382 
00383 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a>(<span class="keyword">const</span> string &amp;name,
00384   <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00385 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a>(<span class="keyword">const</span> string &amp;name,
00386   <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00387 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a>(<span class="keyword">const</span> string &amp;name,
00388   <span class="keyword">const</span> <span class="keywordtype">float</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00389 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a>(<span class="keyword">const</span> string &amp;name,
00390   <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00391 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a>(<span class="keyword">const</span> string &amp;name,
00392   <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;value, <span class="keyword">const</span> string &amp;comment)
00393   {
00394   assert_connected(<span class="stringliteral">"fitshandle::add_key()"</span>);
00395   check_key_present (name);
00396   <span class="keywordtype">int</span> val=value;
00397   fits_write_key (fptr, TLOGICAL, const_cast&lt;char *&gt;(name.c_str()),
00398     &amp;val, const_cast&lt;char *&gt;(comment.c_str()),
00399     &amp;status);
00400   check_errors();
00401   }
00402 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_2">fitshandle::add_key</a> (<span class="keyword">const</span> string &amp;name,
00403   <span class="keyword">const</span> string &amp;value, <span class="keyword">const</span> string &amp;comment)
00404   {
00405   assert_connected(<span class="stringliteral">"fitshandle::add_key()"</span>);
00406   check_key_present (name);
00407   fits_write_key (fptr, TSTRING, const_cast&lt;char *&gt;(name.c_str()),
00408     const_cast&lt;char *&gt;(value.c_str()), const_cast&lt;char *&gt;(comment.c_str()),
00409     &amp;status);
00410   check_errors();
00411   }
00412 
<a name="l00413"></a><a class="code" href="classfitshandle.html#z5_3">00413</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a> (<span class="keyword">const</span> string &amp;name,
00414   <span class="keyword">const</span> T &amp;value, <span class="keyword">const</span> string &amp;comment)
00415   {
00416   assert_connected(<span class="stringliteral">"fitshandle::update_key()"</span>);
00417   fits_update_key (fptr, FITSUTIL&lt;T&gt;::DTYPE, const_cast&lt;char *&gt;(name.c_str()),
00418     const_cast&lt;T *&gt;(&amp;value), const_cast&lt;char *&gt;(comment.c_str()), &amp;status);
00419   check_errors();
00420   }
00421 
00422 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a>(<span class="keyword">const</span> string &amp;name,
00423   <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00424 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a>(<span class="keyword">const</span> string &amp;name,
00425   <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00426 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a>(<span class="keyword">const</span> string &amp;name,
00427   <span class="keyword">const</span> <span class="keywordtype">float</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00428 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a>(<span class="keyword">const</span> string &amp;name,
00429   <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;value, <span class="keyword">const</span> string &amp;comment);
00430 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a>(<span class="keyword">const</span> string &amp;name,
00431   <span class="keyword">const</span> <span class="keywordtype">bool</span> &amp;value, <span class="keyword">const</span> string &amp;comment)
00432   {
00433   assert_connected(<span class="stringliteral">"fitshandle::update_key()"</span>);
00434   <span class="keywordtype">int</span> val=value;
00435   fits_update_key (fptr, TLOGICAL, const_cast&lt;char *&gt;(name.c_str()),
00436     &amp;val, const_cast&lt;char *&gt;(comment.c_str()),
00437     &amp;status);
00438   check_errors();
00439   }
00440 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_3">fitshandle::update_key</a> (<span class="keyword">const</span> string &amp;name,
00441   <span class="keyword">const</span> string &amp;value, <span class="keyword">const</span> string &amp;comment)
00442   {
00443   assert_connected(<span class="stringliteral">"fitshandle::update_key()"</span>);
00444   fits_update_key (fptr, TSTRING, const_cast&lt;char *&gt;(name.c_str()),
00445     const_cast&lt;char *&gt;(value.c_str()), const_cast&lt;char *&gt;(comment.c_str()),
00446     &amp;status);
00447   check_errors();
00448   }
00449 
<a name="l00450"></a><a class="code" href="classfitshandle.html#z5_4">00450</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_4">fitshandle::delete_key</a> (<span class="keyword">const</span> string &amp;name)
00451   {
00452   assert_connected(<span class="stringliteral">"fitshandle::delete_key()"</span>);
00453   fits_delete_key (fptr, const_cast&lt;char *&gt;(name.c_str()), &amp;status);
00454   check_errors();
00455   }
00456 
<a name="l00457"></a><a class="code" href="classfitshandle.html#z5_5">00457</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_5">fitshandle::add_comment</a>(<span class="keyword">const</span> string &amp;comment)
00458   {
00459   assert_connected(<span class="stringliteral">"fitshandle::add_comment()"</span>);
00460   fits_write_comment(fptr,const_cast&lt;char *&gt;(comment.c_str()),&amp;status);
00461   check_errors();
00462   }
00463 
<a name="l00464"></a><a class="code" href="classfitshandle.html#z5_6">00464</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a> (<span class="keyword">const</span> string &amp;name, T &amp;value)
00465   {
00466   assert_connected(<span class="stringliteral">"fitshandle::get_key()"</span>);
00467   fits_read_key (fptr, FITSUTIL&lt;T&gt;::DTYPE, const_cast&lt;char *&gt;(name.c_str()),
00468     &amp;value, 0, &amp;status);
00469   <span class="keywordflow">if</span> (status==KEY_NO_EXIST) <span class="keywordflow">throw</span> Message_error
00470     (<span class="stringliteral">"Fitshandle::get_key(): key "</span>+name+<span class="stringliteral">" not found"</span>);
00471   check_errors();
00472   }
00473 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a>(<span class="keyword">const</span> string &amp;name,<span class="keywordtype">int</span> &amp;value);
00474 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a>(<span class="keyword">const</span> string &amp;name,<span class="keywordtype">long</span> &amp;value);
00475 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a>(<span class="keyword">const</span> string &amp;name,<span class="keywordtype">float</span> &amp;value);
00476 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a>(<span class="keyword">const</span> string &amp;name,<span class="keywordtype">double</span> &amp;value);
00477 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a>(<span class="keyword">const</span> string &amp;name,<span class="keywordtype">bool</span> &amp;value)
00478   {
00479   assert_connected(<span class="stringliteral">"fitshandle::get_key()"</span>);
00480   <span class="keywordtype">int</span> val;
00481   fits_read_key (fptr, TLOGICAL, const_cast&lt;char *&gt;(name.c_str()), &amp;val, 0,
00482     &amp;status);
00483   <span class="keywordflow">if</span> (status==KEY_NO_EXIST) <span class="keywordflow">throw</span> Message_error
00484     (<span class="stringliteral">"Fitshandle::get_key(): key "</span>+name+<span class="stringliteral">" not found"</span>);
00485   check_errors();
00486   value=val;
00487   }
00488 <span class="keyword">template</span>&lt;&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z5_6">fitshandle::get_key</a> (<span class="keyword">const</span> string &amp;name,string &amp;value)
00489   {
00490   <span class="keywordtype">char</span> tmp[2049];
00491   assert_connected(<span class="stringliteral">"fitshandle::get_key()"</span>);
00492   fits_read_key (fptr, TSTRING, const_cast&lt;char *&gt;(name.c_str()), tmp, 0,
00493     &amp;status);
00494   <span class="keywordflow">if</span> (status==KEY_NO_EXIST) <span class="keywordflow">throw</span> Message_error
00495     (<span class="stringliteral">"Fitshandle::get_key(): key "</span>+name+<span class="stringliteral">" not found"</span>);
00496   check_errors();
00497   value=tmp;
00498   }
00499 
<a name="l00500"></a><a class="code" href="classfitshandle.html#z5_8">00500</a> <span class="keywordtype">bool</span> <a class="code" href="classfitshandle.html#z5_8">fitshandle::key_present</a>(<span class="keyword">const</span> string &amp;name)
00501   {
00502   <span class="keywordtype">char</span> card[81];
00503   fits_read_card(fptr, const_cast&lt;char *&gt;(name.c_str()), card, &amp;status);
00504   <span class="keywordflow">if</span> (status==KEY_NO_EXIST)
00505     { fits_clear_errmsg(); status=0; <span class="keywordflow">return</span> <span class="keyword">false</span>; }
00506   check_errors();
00507   <span class="keywordflow">return</span> <span class="keyword">true</span>;
00508   }
00509 
<a name="l00510"></a><a class="code" href="classfitshandle.html#z1_8">00510</a> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z1_8">fitshandle::assert_pdmtype</a> (<span class="keyword">const</span> string &amp;pdmtype)
00511   {
00512   string type;
00513   <a class="code" href="classfitshandle.html#z5_6">get_key</a>(<span class="stringliteral">"PDMTYPE"</span>,type);
00514   <span class="keywordflow">if</span> (pdmtype==type) <span class="keywordflow">return</span>;
00515   cerr &lt;&lt; <span class="stringliteral">"PDMTYPE "</span> &lt;&lt; pdmtype &lt;&lt; <span class="stringliteral">" expected, but found "</span> &lt;&lt; type &lt;&lt; endl;
00516   }
00517 
00518 <span class="keywordtype">void</span> fitshandle::read_column_raw_void
00519   (<span class="keywordtype">int</span> colnum, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> type, <span class="keywordtype">long</span> num, <span class="keywordtype">long</span> offset)
00520   {
00521   <span class="keywordflow">switch</span> (type)
00522     {
00523     <span class="keywordflow">case</span> PLANCK_INT32:
00524       read_col (colnum, data, num, TINT, offset); <span class="keywordflow">break</span>;
00525     <span class="keywordflow">case</span> PLANCK_FLOAT32:
00526       read_col (colnum, data, num, TFLOAT, offset); <span class="keywordflow">break</span>;
00527     <span class="keywordflow">case</span> PLANCK_FLOAT64:
00528       read_col (colnum, data, num, TDOUBLE, offset); <span class="keywordflow">break</span>;
00529     <span class="keywordflow">case</span> PLANCK_STRING:
00530       {
00531       string *data2 = static_cast&lt;string *&gt; (data);
00532       assert_table_hdu(<span class="stringliteral">"fitshandle::read_column()"</span>,colnum);
00533       <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (num&lt;=(nrows_-offset),
00534         <span class="stringliteral">"read_column(): array too large"</span>);
00535       <a class="code" href="classarr2b.html">arr2b&lt;char&gt;</a> tdata(num, columns_[colnum-1].repcount()+1);
00536       fits_read_col (fptr, TSTRING, colnum, offset+1, 1, num,
00537         0, tdata, 0, &amp;status);
00538       check_errors();
00539       <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0;m&lt;num;++m) data2[m]=tdata[m];
00540       <span class="keywordflow">break</span>;
00541       }
00542     <span class="keywordflow">default</span>:
00543       <span class="keywordflow">throw</span> Message_error (<span class="stringliteral">"unsupported data type in read_column_raw_void()"</span>);
00544     }
00545   }
00546 
00547 <span class="keywordtype">void</span> fitshandle::write_column_raw_void
00548   (<span class="keywordtype">int</span> colnum, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> type, <span class="keywordtype">long</span> num, <span class="keywordtype">long</span> offset)
00549   {
00550   <span class="keywordflow">switch</span> (type)
00551     {
00552     <span class="keywordflow">case</span> PLANCK_INT32:
00553       write_col (colnum, data, num, TINT, offset); <span class="keywordflow">break</span>;
00554     <span class="keywordflow">case</span> PLANCK_FLOAT32:
00555       write_col (colnum, data, num, TFLOAT, offset); <span class="keywordflow">break</span>;
00556     <span class="keywordflow">case</span> PLANCK_FLOAT64:
00557       write_col (colnum, data, num, TDOUBLE, offset); <span class="keywordflow">break</span>;
00558     <span class="keywordflow">case</span> PLANCK_STRING:
00559       {
00560       <span class="keyword">const</span> string *data2 = static_cast&lt;const string *&gt; (data);
00561       assert_table_hdu(<span class="stringliteral">"fitshandle::write_column()"</span>,colnum);
00562       <span class="keywordtype">int</span> stringlen = columns_[colnum-1].<a class="code" href="classfitshandle.html#z3_5">repcount</a>()+1;
00563       <a class="code" href="classarr2b.html">arr2b&lt;char&gt;</a> tdata(num, stringlen);
00564       <span class="keywordflow">for</span> (<span class="keywordtype">long</span> m=0;m&lt;num;++m)
00565         {
00566         strncpy(tdata[m],data2[m].c_str(),stringlen-1);
00567         tdata[m][stringlen-1] = <span class="charliteral">'\0'</span>;
00568         }
00569       fits_write_col (fptr, TSTRING, colnum, offset+1, 1, num,
00570         tdata, &amp;status);
00571       fits_get_num_rows (fptr, &amp;nrows_, &amp;status);
00572       check_errors();
00573       <span class="keywordflow">break</span>;
00574       }
00575     <span class="keywordflow">default</span>:
00576       <span class="keywordflow">throw</span> Message_error (<span class="stringliteral">"unsupported data type in write_column_raw_void()"</span>);
00577     }
00578   }
00579 
<a name="l00580"></a><a class="code" href="classfitshandle.html#z9_3">00580</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_3">fitshandle::write_image</a> (<span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;T&gt;</a> &amp;data)
00581   {
00582   assert_image_hdu(<span class="stringliteral">"fitshandle::write_image()"</span>);
00583   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (axes_.size()==2, <span class="stringliteral">"wrong number of dimensions"</span>);
00584   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (axes_[0]==data.<a class="code" href="classarr2.html#a4">size1</a>(), <span class="stringliteral">"wrong size of dimension 1"</span>);
00585   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (axes_[1]==data.<a class="code" href="classarr2.html#a5">size2</a>(), <span class="stringliteral">"wrong size of dimension 2"</span>);
00586 
00587   fits_write_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, 1, axes_[0]*axes_[1],
00588     const_cast&lt;T *&gt;(&amp;data[0][0]), &amp;status);
00589   check_errors();
00590   }
00591 
00592 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_3">fitshandle::write_image</a> (<span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;float&gt;</a> &amp;data);
00593 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_3">fitshandle::write_image</a> (<span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;double&gt;</a> &amp;data);
00594 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_3">fitshandle::write_image</a> (<span class="keyword">const</span> <a class="code" href="classarr2.html">arr2&lt;int&gt;</a> &amp;data);
00595 
00596 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> fitshandle::write_subimage
<a name="l00597"></a><a class="code" href="classfitshandle.html#z9_4">00597</a>   (<span class="keyword">const</span> <a class="code" href="classarr.html">arr&lt;T&gt;</a> &amp;data, <span class="keywordtype">long</span> offset)
00598   {
00599   assert_image_hdu(<span class="stringliteral">"fitshandle::write_subimage()"</span>);
00600   fits_write_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, 1+offset,
00601       data.size(), const_cast&lt;T *&gt;(&amp;data[0]), &amp;status);
00602   check_errors();
00603   }
00604 
00605 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_4">fitshandle::write_subimage</a> (<span class="keyword">const</span> <a class="code" href="classarr.html">arr&lt;float&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00606 <span class="keyword">template</span> <span class="keywordtype">void</span> fitshandle::write_subimage
00607   (<span class="keyword">const</span> <a class="code" href="classarr.html">arr&lt;double&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00608 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_4">fitshandle::write_subimage</a> (<span class="keyword">const</span> <a class="code" href="classarr.html">arr&lt;int&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00609 
<a name="l00610"></a><a class="code" href="classfitshandle.html#z9_0">00610</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_0">fitshandle::read_image</a> (<a class="code" href="classarr2.html">arr2&lt;T&gt;</a> &amp;data)
00611   {
00612   assert_image_hdu(<span class="stringliteral">"fitshandle::read_image()"</span>);
00613   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (axes_.size()==2, <span class="stringliteral">"wrong number of dimensions"</span>);
00614   data.<a class="code" href="classarr2.html#a7">alloc</a>(axes_[0], axes_[1]);
00615   fits_read_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, 1, axes_[0]*axes_[1], 0,
00616     &amp;data[0][0], 0, &amp;status);
00617   check_errors();
00618   }
00619 
00620 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_0">fitshandle::read_image</a> (<a class="code" href="classarr2.html">arr2&lt;float&gt;</a> &amp;data);
00621 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_0">fitshandle::read_image</a> (<a class="code" href="classarr2.html">arr2&lt;double&gt;</a> &amp;data);
00622 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_0">fitshandle::read_image</a> (<a class="code" href="classarr2.html">arr2&lt;int&gt;</a> &amp;data);
00623 
00624 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> fitshandle::read_subimage
<a name="l00625"></a><a class="code" href="classfitshandle.html#z9_1">00625</a>   (<a class="code" href="classarr2.html">arr2&lt;T&gt;</a> &amp;data, <span class="keywordtype">int</span> xl, <span class="keywordtype">int</span> yl)
00626   {
00627   assert_image_hdu(<span class="stringliteral">"fitshandle::read_subimage()"</span>);
00628   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (axes_.size()==2, <span class="stringliteral">"wrong number of dimensions"</span>);
00629   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;data.size1(); ++m)
00630     fits_read_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, (xl+m)*axes_[1]+yl+1,
00631       data.size2(), 0, &amp;data[m][0], 0, &amp;status);
00632   check_errors();
00633   }
00634 
00635 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr2.html">arr2&lt;float&gt;</a> &amp;data, <span class="keywordtype">int</span> xl, <span class="keywordtype">int</span> yl);
00636 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr2.html">arr2&lt;double&gt;</a> &amp;data, <span class="keywordtype">int</span> xl, <span class="keywordtype">int</span> yl);
00637 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr2.html">arr2&lt;int&gt;</a> &amp;data, <span class="keywordtype">int</span> xl, <span class="keywordtype">int</span> yl);
00638 
<a name="l00639"></a><a class="code" href="classfitshandle.html#z9_2">00639</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr.html">arr&lt;T&gt;</a> &amp;data, <span class="keywordtype">long</span> offset)
00640   {
00641   assert_image_hdu(<span class="stringliteral">"fitshandle::read_subimage()"</span>);
00642   fits_read_img (fptr, FITSUTIL&lt;T&gt;::DTYPE, 1+offset,
00643       data.<a class="code" href="classarr.html#a5">size</a>(), 0, &amp;data[0], 0, &amp;status);
00644   check_errors();
00645   }
00646 
00647 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr.html">arr&lt;float&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00648 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr.html">arr&lt;double&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00649 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="classfitshandle.html#z9_1">fitshandle::read_subimage</a> (<a class="code" href="classarr.html">arr&lt;int&gt;</a> &amp;data, <span class="keywordtype">long</span> offset);
00650 
00651 <span class="keywordtype">void</span> fitshandle::add_healpix_keys (<span class="keywordtype">int</span> datasize)
00652   {
00653   <span class="keywordtype">int</span> nside = <a class="code" href="group__mathutilsgroup.html#ga10">isqrt</a>(datasize/12);
00654   <a class="code" href="group__assertgroup.html#ga1">planck_assert</a> (12*nside*nside==datasize, <span class="stringliteral">"Wrong Healpix map size"</span>);
00655 
00656   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"PIXTYPE"</span>,string(<span class="stringliteral">"HEALPIX"</span>),<span class="stringliteral">"HEALPIX pixelisation"</span>);
00657   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"ORDERING"</span>,string(<span class="stringliteral">"RING"</span>),
00658            <span class="stringliteral">"Pixel ordering scheme, either RING or NESTED"</span>);
00659   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"NSIDE"</span>,nside,<span class="stringliteral">"Resolution parameter for HEALPIX"</span>);
00660   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"FIRSTPIX"</span>,0,<span class="stringliteral">"First pixel # (0 based)"</span>);
00661   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"LASTPIX"</span>,datasize-1,<span class="stringliteral">"Last pixel # (0 based)"</span>);
00662   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"INDXSCHM"</span>,string(<span class="stringliteral">"IMPLICIT"</span>), <span class="stringliteral">"Indexing : IMPLICIT or EXPLICIT"</span>);
00663   <a class="code" href="classfitshandle.html#z5_2">add_key</a> (<span class="stringliteral">"GRAIN"</span>,0,<span class="stringliteral">"Grain of pixel indexing"</span>);
00664   }
</pre></div><hr><address style="align: right;"><small>
Generated on Fri Jul 8 09:37:14 2005 for LevelS C++ support library
</a> </small></address>
</body>
</html>

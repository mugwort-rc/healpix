<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LevelS C++ support library: trafos.cc Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">cxxsupport</a></div>
<h1>trafos.cc</h1><a href="trafos_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 <span class="comment"></span>
00027 <span class="comment">/*! \file trafos.cc</span>
00028 <span class="comment"> *  Celestial coordinate transformations.</span>
00029 <span class="comment"> *</span>
00030 <span class="comment"> *  Copyright (C) 2005 Max-Planck-Society</span>
00031 <span class="comment"> * \author Martin Reinecke</span>
00032 <span class="comment"> */</span>
00033 
00034 <span class="preprocessor">#include "<a class="code" href="trafos_8h.html">trafos.h</a>"</span>
00035 <span class="preprocessor">#include "<a class="code" href="constants_8h.html">constants.h</a>"</span>
00036 
00037 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00038 
00039 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_dp_precess (<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> iepoch,
00040   <span class="keywordtype">double</span> oepoch)
00041   {
00042   <span class="comment">// Z-axis rotation by OBL_LONG:</span>
00043   <span class="keywordtype">double</span> Tm = ((oepoch+iepoch)*0.5 - 1900.) *0.01;
00044   <span class="keywordtype">double</span> gp_long  = (oepoch-iepoch) * (50.2564+0.0222*Tm) / 3600.;
00045   <span class="keywordtype">double</span> obl_long = 180. - (173. + (57.06+54.77*Tm) / 60.) + gp_long*0.5;
00046   <span class="keywordtype">double</span> dco = cos(obl_long*degr2rad), dso = sin(obl_long*degr2rad);
00047   <a class="code" href="classvec3.html">vec3</a> ov (iv.<a class="code" href="classvec3.html#o0">x</a>*dco-iv.<a class="code" href="classvec3.html#o1">y</a>*dso, iv.<a class="code" href="classvec3.html#o0">x</a>*dso+iv.<a class="code" href="classvec3.html#o1">y</a>*dco, iv.<a class="code" href="classvec3.html#o2">z</a>);
00048 
00049   <span class="comment">// X-axis rotation by dE:</span>
00050   <span class="keywordtype">double</span> dE = (oepoch-iepoch) * (0.4711-0.0007*Tm) / 3600.;
00051   <span class="keywordtype">double</span> dce = cos(dE*degr2rad), dse = sin(dE*degr2rad);
00052   <span class="keywordtype">double</span> temp = ov.<a class="code" href="classvec3.html#o1">y</a>*dce - ov.<a class="code" href="classvec3.html#o2">z</a>*dse;
00053   ov.<a class="code" href="classvec3.html#o2">z</a> = ov.<a class="code" href="classvec3.html#o1">y</a>*dse + ov.<a class="code" href="classvec3.html#o2">z</a>*dce;
00054   ov.<a class="code" href="classvec3.html#o1">y</a> = temp;
00055 
00056   <span class="comment">// Z-axis rotation by GP_LONG - OBL_LONG:</span>
00057   <span class="keywordtype">double</span> dL = gp_long - obl_long;
00058   <span class="keywordtype">double</span> dcl = cos(dL*degr2rad), dsl = sin(dL*degr2rad);
00059   temp = ov.<a class="code" href="classvec3.html#o0">x</a>*dcl - ov.<a class="code" href="classvec3.html#o1">y</a>*dsl;
00060   ov.<a class="code" href="classvec3.html#o1">y</a> = ov.<a class="code" href="classvec3.html#o0">x</a>*dsl + ov.<a class="code" href="classvec3.html#o1">y</a>*dcl;
00061   ov.<a class="code" href="classvec3.html#o0">x</a> = temp;
00062 
00063   <span class="keywordflow">return</span> ov;
00064   }
00065 
00066 <span class="keywordtype">double</span> Trafo::get_epsilon (<span class="keywordtype">double</span> epoch)
00067   {
00068   <span class="keywordtype">double</span> T = (epoch - 1900.) * 0.01; 
00069   <span class="keywordtype">double</span> epsilon = 23.452294 - 0.0130125*T - 1.63889e-6*T*T + 5.02778e-7*T*T*T;
00070   <span class="keywordflow">return</span> epsilon*degr2rad;
00071   }
00072 <span class="comment"></span>
00073 <span class="comment">/*! Routine to convert from ecliptic coordinates to equatorial (celestial)</span>
00074 <span class="comment">    coordinates at the given epoch.  Adapted from the COBLIB routine by Dr.</span>
00075 <span class="comment">    E. Wright. */</span>
00076 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_dp_e_to_q (<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> epoch)
00077   {
00078   <span class="keywordtype">double</span> epsilon=get_epsilon(epoch);
00079   <span class="keywordtype">double</span> dc = cos(epsilon), ds = sin(epsilon);
00080   <span class="keywordflow">return</span> <a class="code" href="classvec3.html">vec3</a> (iv.<a class="code" href="classvec3.html#o0">x</a>, dc*iv.<a class="code" href="classvec3.html#o1">y</a>-ds*iv.<a class="code" href="classvec3.html#o2">z</a>, dc*iv.<a class="code" href="classvec3.html#o2">z</a>+ds*iv.<a class="code" href="classvec3.html#o1">y</a>);
00081   }
00082 
00083 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_dp_q_to_e (<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> epoch)
00084   {
00085   <span class="keywordtype">double</span> epsilon=-get_epsilon(epoch);
00086   <span class="keywordtype">double</span> dc = cos(epsilon), ds = sin(epsilon);
00087   <span class="keywordflow">return</span> <a class="code" href="classvec3.html">vec3</a> (iv.<a class="code" href="classvec3.html#o0">x</a>, dc*iv.<a class="code" href="classvec3.html#o1">y</a>-ds*iv.<a class="code" href="classvec3.html#o2">z</a>, dc*iv.<a class="code" href="classvec3.html#o2">z</a>+ds*iv.<a class="code" href="classvec3.html#o1">y</a>);
00088   }
00089 <span class="comment"></span>
00090 <span class="comment">/*! Routine to convert galactic coordinates to ecliptic (celestial) </span>
00091 <span class="comment">    coordinates at the given epoch.  First the conversion to ecliptic </span>
00092 <span class="comment">    2000 is done, then if necessary the results are precessed. */</span>
00093 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_dp_g_to_e (<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> epoch)
00094   {
00095   <span class="keyword">static</span> <a class="code" href="classrotmatrix.html">rotmatrix</a> T (-0.054882486,  0.494116468, -0.867661702,
00096                       -0.993821033, -0.110993846, -0.000346354,
00097                       -0.096476249,  0.862281440,  0.497154957);
00098   <a class="code" href="classvec3.html">vec3</a> hv=T.Transform(iv);
00099 
00100   <span class="keywordflow">if</span> (!<a class="code" href="group__mathutilsgroup.html#ga0">approx</a>(epoch,2000.))
00101     hv=xcc_dp_precess(hv,2000.,epoch);
00102 
00103   <span class="keywordflow">return</span> hv;
00104   }
00105 <span class="comment"></span>
00106 <span class="comment">/*! Routine to convert ecliptic (celestial) coordinates at the given</span>
00107 <span class="comment">    epoch to galactic coordinates.  The ecliptic coordinates are first</span>
00108 <span class="comment">    precessed to 2000.0, then converted. */</span>
00109 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_dp_e_to_g (<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> epoch)
00110   {
00111   <span class="keyword">static</span> <a class="code" href="classrotmatrix.html">rotmatrix</a> T (-0.054882486, -0.993821033, -0.096476249,
00112                        0.494116468, -0.110993846,  0.862281440,
00113                       -0.867661702, -0.000346354,  0.497154957);
00114   <a class="code" href="classvec3.html">vec3</a> hv=iv;
00115   <span class="keywordflow">if</span> (!<a class="code" href="group__mathutilsgroup.html#ga0">approx</a>(epoch,2000.))
00116     hv=xcc_dp_precess(hv,epoch,2000.);
00117 
00118   <span class="keywordflow">return</span> T.Transform(hv);
00119   }
00120 <span class="comment"></span>
00121 <span class="comment">/*! Function to convert between standard coordinate systems, including</span>
00122 <span class="comment">    precession. */</span>
00123 <a class="code" href="classvec3.html">vec3</a> Trafo::xcc_v_convert(<span class="keyword">const</span> <a class="code" href="classvec3.html">vec3</a> &amp;iv, <span class="keywordtype">double</span> iepoch, <span class="keywordtype">double</span> oepoch,
00124   coordsys isys,coordsys osys)
00125   {
00126   <a class="code" href="classvec3.html">vec3</a> xv;
00127   <span class="keywordflow">if</span> (isys == Ecliptic)
00128     xv=iv;
00129   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isys == Equatorial)
00130     xv = xcc_dp_q_to_e(iv,iepoch);
00131   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isys == Galactic)
00132     xv = xcc_dp_g_to_e(iv,iepoch);
00133   <span class="keywordflow">else</span>
00134     <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"Unknown input coordinate system"</span>);
00135 
00136   <a class="code" href="classvec3.html">vec3</a> yv = <a class="code" href="group__mathutilsgroup.html#ga0">approx</a>(iepoch,oepoch) ? xv : xcc_dp_precess(xv,iepoch,oepoch);
00137 
00138   <a class="code" href="classvec3.html">vec3</a> ov;
00139   <span class="keywordflow">if</span> (osys == Ecliptic)
00140     ov = yv;
00141   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (osys == Equatorial)
00142     ov = xcc_dp_e_to_q(yv,oepoch);
00143   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (osys == Galactic)
00144     ov = xcc_dp_e_to_g(yv,oepoch);
00145   <span class="keywordflow">else</span>
00146     <span class="keywordflow">throw</span> Message_error(<span class="stringliteral">"Unknown output coordinate system"</span>);
00147 
00148   <span class="keywordflow">return</span> ov;
00149   }
00150 
00151 <span class="keywordtype">void</span> Trafo::coordsys2matrix (<span class="keywordtype">double</span> iepoch, <span class="keywordtype">double</span> oepoch,
00152   coordsys isys, coordsys osys, <a class="code" href="classrotmatrix.html">rotmatrix</a> &amp;matrix)
00153   {
00154   <a class="code" href="classvec3.html">vec3</a> v1p = xcc_v_convert(<a class="code" href="classvec3.html">vec3</a>(1,0,0),iepoch,oepoch,isys,osys),
00155        v2p = xcc_v_convert(<a class="code" href="classvec3.html">vec3</a>(0,1,0),iepoch,oepoch,isys,osys),
00156        v3p = xcc_v_convert(<a class="code" href="classvec3.html">vec3</a>(0,0,1),iepoch,oepoch,isys,osys);
00157   v1p.<a class="code" href="classvec3.html#a2">Normalize</a>(); v2p.<a class="code" href="classvec3.html#a2">Normalize</a>(); v3p.<a class="code" href="classvec3.html#a2">Normalize</a>();
00158   matrix=<a class="code" href="classrotmatrix.html">rotmatrix</a>(v1p,v2p,v3p);
00159   }
</pre></div><hr><address style="align: right;"><small>
Generated on Fri Jul 8 09:37:14 2005 for LevelS C++ support library
</a> </small></address>
</body>
</html>

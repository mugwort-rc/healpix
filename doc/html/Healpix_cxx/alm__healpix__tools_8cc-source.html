<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>alm_healpix_tools.cc Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>alm_healpix_tools.cc</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> *  Copyright (C) 2003, 2004, 2005 Max-Planck-Society</span>
00029 <span class="comment"> *  Author: Martin Reinecke</span>
00030 <span class="comment"> */</span>
00031 
00032 <span class="preprocessor">#include "<a class="code" href="alm__healpix__tools_8h.html">alm_healpix_tools.h</a>"</span>
00033 <span class="preprocessor">#include "<a class="code" href="alm__map__tools_8h.html">alm_map_tools.h</a>"</span>
00034 <span class="preprocessor">#include "<a class="code" href="alm_8h.html">alm.h</a>"</span>
00035 <span class="preprocessor">#include "<a class="code" href="healpix__map_8h.html">healpix_map.h</a>"</span>
00036 <span class="preprocessor">#include "<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/xcomplex_8h.html">xcomplex.h</a>"</span>
00037 
00038 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00039 
00040 <span class="keyword">namespace </span>{
00041 
00042 <span class="keywordtype">void</span> healpix2ringpairs (<span class="keyword">const</span> <a class="code" href="classHealpix__Base.html">Healpix_Base</a> &amp;base,
00043   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight, vector&lt;ringpair&gt; &amp;pair)
00044   {
00045   pair.clear();
00046   <span class="keywordtype">int</span> startpix, ringpix;
00047   <span class="keywordtype">double</span> theta, wgt, phi0;
00048   <span class="keywordtype">bool</span> shifted;
00049   <span class="keywordtype">int</span> nside = base.<a class="code" href="classHealpix__Base.html#a24">Nside</a>();
00050   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;2*nside-1; ++m)
00051     {
00052     base.<a class="code" href="classHealpix__Base.html#a20">get_ring_info2</a> (m+1, startpix, ringpix, theta, shifted);
00053     wgt = weight[m]*fourpi/base.<a class="code" href="classHealpix__Base.html#a25">Npix</a>();
00054     phi0 = shifted ? pi/ringpix : 0;
00055     pair.push_back (<a class="code" href="classringpair.html">ringpair</a>(
00056       <a class="code" href="classringinfo.html">ringinfo</a>(theta, phi0, wgt, ringpix, startpix),
00057       <a class="code" href="classringinfo.html">ringinfo</a>(pi-theta, phi0, wgt, ringpix, base.<a class="code" href="classHealpix__Base.html#a25">Npix</a>()-startpix-ringpix)));
00058     }
00059   base.<a class="code" href="classHealpix__Base.html#a20">get_ring_info2</a> (2*nside, startpix, ringpix, theta, shifted);
00060   wgt = weight[2*nside-1]*fourpi/base.<a class="code" href="classHealpix__Base.html#a25">Npix</a>();
00061   phi0 = shifted ? pi/ringpix : 0;
00062   pair.push_back (<a class="code" href="classringpair.html">ringpair</a>(<a class="code" href="classringinfo.html">ringinfo</a>(theta, phi0, wgt, ringpix, startpix)));
00063   }
00064 
00065 <span class="keywordtype">void</span> healpix2ringpairs (<span class="keyword">const</span> <a class="code" href="classHealpix__Base.html">Healpix_Base</a> &amp;base, vector&lt;ringpair&gt; &amp;pair)
00066   {
00067   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> wgt(2*base.<a class="code" href="classHealpix__Base.html#a24">Nside</a>());
00068   wgt.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a9">fill</a>(1);
00069   healpix2ringpairs(base,wgt,pair);
00070   }
00071 
00072 } <span class="comment">// namespace</span>
00073 
00074 
<a name="l00075"></a><a class="code" href="group__alm__healpix__group.html#a0">00075</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;map,
00076   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight, <span class="keywordtype">bool</span> add_alm)
00077   {
00078   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (map.<a class="code" href="classHealpix__Base.html#a26">Scheme</a>()==<a class="code" href="healpix__base_8h.html#a3a1">RING</a>, <span class="stringliteral">"map2alm: map must be in RING scheme"</span>);
00079   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (weight.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a6">size</a>()&gt;=2*map.<a class="code" href="classHealpix__Base.html#a24">Nside</a>(),
00080     <span class="stringliteral">"map2alm: weight array has too few entries"</span>);
00081 
00082   vector&lt;ringpair&gt; pair;
00083   healpix2ringpairs(map,weight,pair);
00084   <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a>(pair,&amp;map[0],alm,add_alm);
00085   }
00086 
00087 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map,
00088   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight,
00089   <span class="keywordtype">bool</span> add_alm);
00090 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map,
00091   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight,
00092   <span class="keywordtype">bool</span> add_alm);
00093 
<a name="l00094"></a><a class="code" href="group__alm__healpix__group.html#a1">00094</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a1">map2alm_iter</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;map,
00095   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm, <span class="keywordtype">int</span> num_iter, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight)
00096   {
00097   <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a>(map,alm,weight);
00098   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter=1; iter&lt;=num_iter; ++iter)
00099     {
00100     <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> map2(map.<a class="code" href="classHealpix__Base.html#a24">Nside</a>(),map.<a class="code" href="classHealpix__Base.html#a26">Scheme</a>(),SET_NSIDE);
00101     <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a>(alm,map2);
00102     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;map.<a class="code" href="classHealpix__Base.html#a25">Npix</a>(); ++m)
00103       map2[m] = map[m]-map2[m];
00104     <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a>(map2,alm,weight,<span class="keyword">true</span>);
00105     }
00106   }
00107 
00108 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a1">map2alm_iter</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map,
00109   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm, <span class="keywordtype">int</span> num_iter,
00110   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight);
00111 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a1">map2alm_iter</a> (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map,
00112   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm, <span class="keywordtype">int</span> num_iter,
00113   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight);
00114 
00115 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> map2alm_iter2 (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;map,
00116   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm, <span class="keywordtype">double</span> err_abs, <span class="keywordtype">double</span> err_rel)
00117   {
00118   <span class="keywordtype">double</span> x_err_abs=1./err_abs, x_err_rel=1./err_rel;
00119   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> wgt(2*map.<a class="code" href="classHealpix__Base.html#a24">Nside</a>());
00120   wgt.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a9">fill</a>(1);
00121   <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> map2(map);
00122   alm.SetToZero();
00123   <span class="keywordflow">while</span>(<span class="keyword">true</span>)
00124     {
00125     <a class="code" href="group__alm__healpix__group.html#a0">map2alm</a>(map2,alm,wgt,<span class="keyword">true</span>);
00126     <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a>(alm,map2);
00127     <span class="keywordtype">double</span> errmeasure=0;
00128     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;map.<a class="code" href="classHealpix__Base.html#a25">Npix</a>(); ++m)
00129       {
00130       <span class="keywordtype">double</span> err = abs(map[m]-map2[m]);
00131       <span class="keywordtype">double</span> rel = (map[m]!=0) ? abs(err/map[m]) : 1e300;
00132       errmeasure = max(errmeasure,min(err*x_err_abs,rel*x_err_rel));
00133       map2[m] = map[m]-map2[m];
00134       }
00135 cout &lt;&lt; <span class="stringliteral">"map error measure: "</span> &lt;&lt; errmeasure &lt;&lt; endl;
00136     <span class="keywordflow">if</span> (errmeasure&lt;1) <span class="keywordflow">break</span>;
00137     }
00138   }
00139 
00140 <span class="keyword">template</span> <span class="keywordtype">void</span> map2alm_iter2 (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map,
00141   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm, <span class="keywordtype">double</span> err_abs, <span class="keywordtype">double</span> err_rel);
00142 
00143 
00144 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>
<a name="l00145"></a><a class="code" href="group__alm__healpix__group.html#a4">00145</a>   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapT,
00146    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapQ,
00147    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapU,
00148    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00149    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00150    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00151    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight,
00152    <span class="keywordtype">bool</span> add_alm)
00153   {
00154   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (mapT.Scheme()==<a class="code" href="healpix__base_8h.html#a3a1">RING</a>,
00155     <span class="stringliteral">"map2alm_pol: maps must be in RING scheme"</span>);
00156   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (mapT.conformable(mapQ) &amp;&amp; mapT.conformable(mapU),
00157     <span class="stringliteral">"map2alm_pol: maps are not conformable"</span>);
00158   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (weight.size()&gt;=2*mapT.Nside(),
00159     <span class="stringliteral">"map2alm_pol: at least one weight array has too few entries"</span>);
00160 
00161   vector&lt;ringpair&gt; pair;
00162   healpix2ringpairs(mapT,weight,pair);
00163   <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>(pair,&amp;mapT[0],&amp;mapQ[0],&amp;mapU[0],almT,almG,almC,add_alm);
00164   }
00165 
00166 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>
00167   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapT,
00168    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapQ,
00169    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapU,
00170    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00171    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00172    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00173    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight,
00174    <span class="keywordtype">bool</span> add_alm);
00175 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>
00176   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapT,
00177    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapQ,
00178    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapU,
00179    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00180    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00181    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00182    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight,
00183    <span class="keywordtype">bool</span> add_alm);
00184 
00185 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a5">map2alm_pol_iter</a>
<a name="l00186"></a><a class="code" href="group__alm__healpix__group.html#a5">00186</a>   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapT,
00187    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapQ,
00188    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapU,
00189    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00190    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00191    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00192    <span class="keywordtype">int</span> num_iter,
00193    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight)
00194   {
00195   <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>(mapT,mapQ,mapU,almT,almG,almC,weight);
00196   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iter=1; iter&lt;=num_iter; ++iter)
00197     {
00198     <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> mapT2(mapT.Nside(),mapT.Scheme(),SET_NSIDE),
00199                    mapQ2(mapT.Nside(),mapT.Scheme(),SET_NSIDE),
00200                    mapU2(mapT.Nside(),mapT.Scheme(),SET_NSIDE);
00201 
00202     <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a>(almT,almG,almC,mapT2,mapQ2,mapU2);
00203     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;mapT.Npix(); ++m)
00204       {
00205       mapT2[m] = mapT[m]-mapT2[m];
00206       mapQ2[m] = mapQ[m]-mapQ2[m];
00207       mapU2[m] = mapU[m]-mapU2[m];
00208       }
00209     <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>(mapT2,mapQ2,mapU2,almT,almG,almC,weight,<span class="keyword">true</span>);
00210     }
00211   }
00212 
00213 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a5">map2alm_pol_iter</a>
00214   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapT,
00215    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapQ,
00216    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapU,
00217    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00218    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00219    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00220    <span class="keywordtype">int</span> num_iter,
00221    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight);
00222 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a5">map2alm_pol_iter</a>
00223   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapT,
00224    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapQ,
00225    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapU,
00226    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00227    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00228    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00229    <span class="keywordtype">int</span> num_iter,
00230    <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> &amp;weight);
00231 
00232 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> map2alm_pol_iter2
00233   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapT,
00234    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapQ,
00235    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapU,
00236    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00237    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00238    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00239    <span class="keywordtype">double</span> err_abs, <span class="keywordtype">double</span> err_rel)
00240   {
00241   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> wgt(2*mapT.Nside());
00242   wgt.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a9">fill</a>(1);
00243   <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> mapT2(mapT), mapQ2(mapQ), mapU2(mapU);
00244   almT.SetToZero(); almG.SetToZero(); almC.SetToZero();
00245   <span class="keywordflow">while</span>(<span class="keyword">true</span>)
00246     {
00247     <a class="code" href="group__alm__healpix__group.html#a4">map2alm_pol</a>(mapT2,mapQ2,mapU2,almT,almG,almC,wgt,<span class="keyword">true</span>);
00248     <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a>(almT,almG,almC,mapT2,mapQ2,mapU2);
00249     <span class="keywordtype">double</span> errmeasure=0;
00250     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;mapT.Npix(); ++m)
00251       {
00252       <span class="keywordtype">double</span> err = abs(mapT[m]-mapT2[m]);
00253       <span class="keywordtype">double</span> rel = (mapT[m]!=0) ? abs(err/mapT[m]) : 1e300;
00254       errmeasure = max(errmeasure,min(err/err_abs,rel/err_rel));
00255       mapT2[m] = mapT[m]-mapT2[m];
00256       err = abs(mapQ[m]-mapQ2[m]);
00257       rel = (mapQ[m]!=0) ? abs(err/mapQ[m]) : 1e300;
00258       errmeasure = max(errmeasure,min(err/err_abs,rel/err_rel));
00259       mapQ2[m] = mapQ[m]-mapQ2[m];
00260       err = abs(mapU[m]-mapU2[m]);
00261       rel = (mapU[m]!=0) ? abs(err/mapU[m]) : 1e300;
00262       errmeasure = max(errmeasure,min(err/err_abs,rel/err_rel));
00263       mapU2[m] = mapU[m]-mapU2[m];
00264       }
00265 cout &lt;&lt; <span class="stringliteral">"map error measure: "</span> &lt;&lt; errmeasure &lt;&lt; endl;
00266     <span class="keywordflow">if</span> (errmeasure&lt;1) <span class="keywordflow">break</span>;
00267     }
00268   }
00269 
00270 <span class="keyword">template</span> <span class="keywordtype">void</span> map2alm_pol_iter2
00271   (<span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapT,
00272    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapQ,
00273    <span class="keyword">const</span> <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapU,
00274    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00275    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00276    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00277    <span class="keywordtype">double</span> err_abs, <span class="keywordtype">double</span> err_rel);
00278 
00279 
<a name="l00280"></a><a class="code" href="group__alm__healpix__group.html#a8">00280</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm,
00281   <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;map)
00282   {
00283   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (map.<a class="code" href="classHealpix__Base.html#a26">Scheme</a>()==<a class="code" href="healpix__base_8h.html#a3a1">RING</a>, <span class="stringliteral">"alm2map: map must be in RING scheme"</span>);
00284 
00285   vector&lt;ringpair&gt; pair;
00286   healpix2ringpairs(map,pair);
00287   <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a>(alm,pair,&amp;map[0]);
00288   }
00289 
00290 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm,
00291   <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map);
00292 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a8">alm2map</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm,
00293   <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map);
00294 
00295 
00296 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a>
<a name="l00297"></a><a class="code" href="group__alm__healpix__group.html#a9">00297</a>   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00298    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00299    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00300    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapT,
00301    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapQ,
00302    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapU)
00303   {
00304   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (mapT.Scheme()==<a class="code" href="healpix__base_8h.html#a3a1">RING</a>,
00305     <span class="stringliteral">"alm2map_pol: maps must be in RING scheme"</span>);
00306   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (mapT.conformable(mapQ) &amp;&amp; mapT.conformable(mapU),
00307     <span class="stringliteral">"alm2map_pol: maps are not conformable"</span>);
00308 
00309   vector&lt;ringpair&gt; pair;
00310   healpix2ringpairs(mapT,pair);
00311   <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a>(almT,almG,almC,pair,&amp;mapT[0],&amp;mapQ[0],&amp;mapU[0]);
00312   }
00313 
00314 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00315                            <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00316                            <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00317                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapT,
00318                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapQ,
00319                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;mapU);
00320 
00321 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a9">alm2map_pol</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00322                            <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00323                            <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00324                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapT,
00325                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapQ,
00326                            <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;mapU);
00327 
00328 
00329 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a10">alm2map_der1</a>
<a name="l00330"></a><a class="code" href="group__alm__healpix__group.html#a10">00330</a>   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm,
00331    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;map,
00332    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapdth,
00333    <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;T&gt;</a> &amp;mapdph)
00334   {
00335   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (map.Scheme()==<a class="code" href="healpix__base_8h.html#a3a1">RING</a>,
00336     <span class="stringliteral">"alm2map_der1: maps must be in RING scheme"</span>);
00337   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#a1">planck_assert</a> (map.conformable(mapdth) &amp;&amp; map.conformable(mapdph),
00338     <span class="stringliteral">"alm2map_der1: maps are not conformable"</span>);
00339 
00340   vector&lt;ringpair&gt; pair;
00341   healpix2ringpairs(map,pair);
00342   <a class="code" href="group__alm__healpix__group.html#a10">alm2map_der1</a>(alm,pair,&amp;map[0],&amp;mapdth[0],&amp;mapdph[0]);
00343   }
00344 
00345 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a10">alm2map_der1</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm,
00346                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map,
00347                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map_dth,
00348                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;double&gt;</a> &amp;map_dph);
00349 
00350 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__healpix__group.html#a10">alm2map_der1</a> (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm,
00351                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map,
00352                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map_dth,
00353                             <a class="code" href="classHealpix__Map.html">Healpix_Map&lt;float&gt;</a> &amp;map_dph);
</pre></div><hr><address style="align: right;"><small>
Generated on Thu Feb 19 17:23:18 2009 for Healpix C++
</a> </small></address>
</body>
</html>

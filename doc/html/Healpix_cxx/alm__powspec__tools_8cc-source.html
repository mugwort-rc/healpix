<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Healpix C++: alm_powspec_tools.cc Source File</title>
<link href="sheet.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.9.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">Healpix_cxx</a></div>
<h1>alm_powspec_tools.cc</h1><div class="fragment"><pre class="fragment">00001 <span class="comment">/*</span>
00002 <span class="comment"> *  This file is part of Healpix_cxx.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> *  Healpix_cxx is free software; you can redistribute it and/or modify</span>
00005 <span class="comment"> *  it under the terms of the GNU General Public License as published by</span>
00006 <span class="comment"> *  the Free Software Foundation; either version 2 of the License, or</span>
00007 <span class="comment"> *  (at your option) any later version.</span>
00008 <span class="comment"> *</span>
00009 <span class="comment"> *  Healpix_cxx is distributed in the hope that it will be useful,</span>
00010 <span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
00011 <span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
00012 <span class="comment"> *  GNU General Public License for more details.</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> *  You should have received a copy of the GNU General Public License</span>
00015 <span class="comment"> *  along with Healpix_cxx; if not, write to the Free Software</span>
00016 <span class="comment"> *  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
00017 <span class="comment"> *</span>
00018 <span class="comment"> *  For more information about HEALPix, see http://healpix.jpl.nasa.gov</span>
00019 <span class="comment"> */</span>
00020 
00021 <span class="comment">/*</span>
00022 <span class="comment"> *  Healpix_cxx is being developed at the Max-Planck-Institut fuer Astrophysik</span>
00023 <span class="comment"> *  and financially supported by the Deutsches Zentrum fuer Luft- und Raumfahrt</span>
00024 <span class="comment"> *  (DLR).</span>
00025 <span class="comment"> */</span>
00026 
00027 <span class="comment">/*</span>
00028 <span class="comment"> *  Copyright (C) 2003, 2004, 2005 Max-Planck-Society</span>
00029 <span class="comment"> *  Author: Martin Reinecke</span>
00030 <span class="comment"> */</span>
00031 
00032 <span class="preprocessor">#include "<a class="code" href="alm__powspec__tools_8h.html">alm_powspec_tools.h</a>"</span>
00033 <span class="preprocessor">#include "<a class="code" href="alm_8h.html">alm.h</a>"</span>
00034 <span class="preprocessor">#include "<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/planck__rng_8h.html">planck_rng.h</a>"</span>
00035 <span class="preprocessor">#include "powspec.h"</span>
00036 <span class="preprocessor">#include "<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/xcomplex_8h.html">xcomplex.h</a>"</span>
00037 <span class="preprocessor">#include "<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/rotmatrix_8h.html">rotmatrix.h</a>"</span>
00038 <span class="preprocessor">#include "openmp_support.h"</span>
00039 
00040 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00041 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga0">create_alm</a>
<a name="l00042"></a><a class="code" href="group__alm__ps__group.html#ga0">00042</a>   (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec, <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm, <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng)
00043   {
00044   <span class="keywordtype">int</span> lmax = alm.Lmax();
00045   <span class="keywordtype">int</span> mmax = alm.Mmax();
00046   <span class="keyword">const</span> <span class="keywordtype">double</span> hsqrt2 = 1/sqrt(2.);
00047 
00048   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00049     {
00050     <span class="keywordtype">double</span> rms_tt = sqrt(powspec.tt(l));
00051     <span class="keywordtype">double</span> zeta1_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>();
00052     alm(l,0) = zeta1_r * rms_tt;
00053     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=min(l,mmax); ++m)
00054       {
00055       zeta1_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00056       <span class="keywordtype">double</span> zeta1_i = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00057       alm(l,m).Set (zeta1_r*rms_tt, zeta1_i*rms_tt);
00058       }
00059     }
00060   }
00061 
00062 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga0">create_alm</a> (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec,
00063   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm, <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng);
00064 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga0">create_alm</a> (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec,
00065   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm, <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng);
00066 
00067 
00068 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga1">create_alm_pol</a>
<a name="l00069"></a><a class="code" href="group__alm__ps__group.html#ga1">00069</a>   (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec,
00070    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00071    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00072    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00073    <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng)
00074   {
00075   <span class="keywordtype">int</span> lmax = almT.Lmax();
00076   <span class="keywordtype">int</span> mmax = almT.Mmax();
00077   <span class="keyword">const</span> <span class="keywordtype">double</span> hsqrt2 = 1/sqrt(2.);
00078 
00079   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00080     {
00081     <span class="keywordtype">double</span> rms_tt=0, rms_g1=0;
00082     <span class="keywordflow">if</span> (powspec.tt(l) != 0)
00083       {
00084       rms_tt = sqrt(powspec.tt(l));
00085       rms_g1 = powspec.tg(l)/rms_tt;
00086       }
00087 
00088     <span class="keywordtype">double</span> zeta1_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>();
00089     almT(l,0) = zeta1_r * rms_tt;
00090     almG(l,0) = zeta1_r * rms_g1;
00091     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=min(l,mmax); ++m)
00092       {
00093       zeta1_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00094       <span class="keywordtype">double</span> zeta1_i = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00095       almT(l,m).Set (zeta1_r*rms_tt, zeta1_i*rms_tt);
00096       almG(l,m).Set (zeta1_r*rms_g1, zeta1_i*rms_g1);
00097       }
00098     }
00099 
00100   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00101     {
00102     <span class="keywordtype">double</span> rms_g2 = 0;
00103     <span class="keywordtype">double</span> rms_cc = 0;
00104     <span class="keywordflow">if</span> (powspec.tt(l) != 0)
00105       {
00106       rms_g2 = powspec.gg(l) - (powspec.tg(l)/powspec.tt(l))*powspec.tg(l);
00107       <span class="keywordflow">if</span> (rms_g2 &lt;= 0)
00108         {
00109         <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (abs(rms_g2) &lt;= 1e-8*abs(powspec.gg(l)),
00110           <span class="stringliteral">"Inconsistent TT, GG and TG spectra at l="</span>+<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__stringutilsgroup.html#gga1">dataToString</a>(l));
00111         rms_g2 = 0;
00112         }
00113       rms_g2 = sqrt(rms_g2);
00114       rms_cc = sqrt(powspec.cc(l));
00115       }
00116     almG(l,0) += rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*rms_g2;
00117     almC(l,0)  = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*rms_cc;
00118 
00119     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=min(l,mmax); ++m)
00120       {
00121       <span class="keywordtype">double</span> zeta2_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00122       <span class="keywordtype">double</span> zeta2_i = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00123       <span class="keywordtype">double</span> zeta3_r = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00124       <span class="keywordtype">double</span> zeta3_i = rng.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html#a4">rand_gauss</a>()*hsqrt2;
00125 
00126       almG(l,m) += <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> (zeta2_r*rms_g2,zeta2_i*rms_g2);
00127       almC(l,m).Set (zeta3_r*rms_cc,zeta3_i*rms_cc);
00128       }
00129     }
00130   }
00131 
00132 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga1">create_alm_pol</a>
00133   (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec,
00134    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00135    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00136    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00137    <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng);
00138 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga1">create_alm_pol</a>
00139   (<span class="keyword">const</span> <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec,
00140    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00141    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00142    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00143    <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classplanck__rng.html">planck_rng</a> &amp;rng);
00144 
00145 
00146 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
<a name="l00147"></a><a class="code" href="group__alm__ps__group.html#ga2">00147</a>   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm, <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec)
00148   {
00149   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> tt(alm.Lmax()+1);
00150   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=alm.Lmax(); ++l)
00151     {
00152     tt[l] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(alm(l,0));
00153     <span class="keywordtype">int</span> limit = min(l,alm.Mmax());
00154     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=limit; ++m)
00155       tt[l] += 2*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(alm(l,m));
00156     tt[l] /= (2*l+1);
00157     }
00158   powspec.Set(tt);
00159   }
00160 
00161 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
00162   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;alm, <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00163 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
00164   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;alm, <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00165 
00166 
00167 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga3">extract_crosspowspec</a>
<a name="l00168"></a><a class="code" href="group__alm__ps__group.html#ga3">00168</a>   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm1,
00169    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm2,<a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec)
00170   {
00171   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (alm1.conformable(alm2),
00172     <span class="stringliteral">"extract_crosspowspec: a_lms are not conformable"</span>);
00173   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> tt(alm1.Lmax()+1);
00174   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=alm1.Lmax(); ++l)
00175     {
00176     tt[l] = alm1(l,0).re*alm2(l,0).re;
00177     <span class="keywordtype">int</span> limit = min(l,alm1.Mmax());
00178     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=limit; ++m)
00179       tt[l] += 2 * (alm1(l,m).re*alm2(l,m).re + alm1(l,m).im*alm2(l,m).im);
00180     tt[l] /= (2*l+1);
00181     }
00182   powspec.Set(tt);
00183   }
00184 
00185 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga3">extract_crosspowspec</a>
00186   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;alm1,
00187    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;alm2, <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00188 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga3">extract_crosspowspec</a>
00189   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;alm1,
00190    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;alm2, <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00191 
00192 
00193 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
<a name="l00194"></a><a class="code" href="group__alm__ps__group.html#ga4">00194</a>   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00195    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00196    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00197    <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec)
00198   {
00199   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (almT.conformable(almG) &amp;&amp; almT.conformable(almC),
00200     <span class="stringliteral">"extract_powspec: a_lms are not conformable"</span>);
00201   <span class="keywordtype">int</span> lmax = almT.Lmax();
00202   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> tt(lmax+1), gg(lmax+1), cc(lmax+1), tg(lmax+1);
00203   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00204     {
00205     tt[l] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almT(l,0));
00206     gg[l] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almG(l,0));
00207     cc[l] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almC(l,0));
00208     tg[l] = (almT(l,0)*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga0">conj</a>(almG(l,0))).re;
00209     <span class="keywordtype">int</span> limit = min(l,almT.Mmax());
00210     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=1; m&lt;=limit; ++m)
00211       {
00212       tt[l] += 2*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almT(l,m));
00213       gg[l] += 2*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almG(l,m));
00214       cc[l] += 2*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga1">norm</a>(almC(l,m));
00215       tg[l] += 2*(almT(l,m)*<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__complexgroup.html#gga0">conj</a>(almG(l,m))).re;
00216       }
00217     tt[l] /= (2*l+1);
00218     gg[l] /= (2*l+1);
00219     cc[l] /= (2*l+1);
00220     tg[l] /= (2*l+1);
00221     }
00222   powspec.Set(tt,gg,cc,tg);
00223   }
00224 
00225 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
00226   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00227    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00228    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00229    <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00230 <span class="keyword">template</span> <span class="keywordtype">void</span> <a class="code" href="group__alm__ps__group.html#ga2">extract_powspec</a>
00231   (<span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00232    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00233    <span class="keyword">const</span> <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00234    <a class="code" href="classPowSpec.html">PowSpec</a> &amp;powspec);
00235 
00236 
00237 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> smooth_with_Gauss
<a name="l00238"></a><a class="code" href="classAlm.html#m0">00238</a>   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;alm, <span class="keywordtype">double</span> fwhm_arcmin)
00239   {
00240   <span class="keywordtype">int</span> fct = (fwhm_arcmin&gt;=0) ? 1 : -1;
00241   <span class="keywordtype">double</span> sigma = fwhm_arcmin/60*degr2rad*fwhm2sigma;
00242   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> gb(alm.Lmax()+1);
00243   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=alm.Lmax(); ++l)
00244     gb[l] = exp(-.5*fct*l*(l+1)*sigma*sigma);
00245   alm.ScaleL(gb);
00246   }
00247 
00248 <span class="keyword">template</span> <span class="keywordtype">void</span> smooth_with_Gauss
00249   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;alm, <span class="keywordtype">double</span> fwhm_arcmin);
00250 <span class="keyword">template</span> <span class="keywordtype">void</span> smooth_with_Gauss
00251   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;alm, <span class="keywordtype">double</span> fwhm_arcmin);
00252 
00253 
00254 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> smooth_with_Gauss
<a name="l00255"></a><a class="code" href="classAlm.html#m1">00255</a>   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00256    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almG,
00257    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00258    <span class="keywordtype">double</span> fwhm_arcmin)
00259   {
00260   <span class="keywordtype">int</span> fct = (fwhm_arcmin&gt;=0) ? 1 : -1;
00261   <span class="keywordtype">double</span> sigma = fwhm_arcmin/60*degr2rad*fwhm2sigma;
00262   <span class="keywordtype">double</span> fact_pol = exp(2*fct*sigma*sigma);
00263   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> gb(almT.Lmax()+1);
00264   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=almT.Lmax(); ++l)
00265     gb[l] = exp(-.5*fct*l*(l+1)*sigma*sigma);
00266   almT.ScaleL(gb);
00267   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=almT.Lmax(); ++l)
00268     gb[l] *= fact_pol;
00269   almG.ScaleL(gb); almC.ScaleL(gb);
00270   }
00271 
00272 <span class="keyword">template</span> <span class="keywordtype">void</span> smooth_with_Gauss
00273   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00274    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almG,
00275    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00276    <span class="keywordtype">double</span> fwhm_arcmin);
00277 <span class="keyword">template</span> <span class="keywordtype">void</span> smooth_with_Gauss
00278   (<a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00279    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almG,
00280    <a class="code" href="classAlm.html">Alm&lt;xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00281    <span class="keywordtype">double</span> fwhm_arcmin);
00282 
00283 <span class="keyword">namespace </span>{
00284 
00285 <span class="preprocessor">#if 0</span>
00286 <span class="preprocessor"></span>
00287 <span class="keyword">class </span>wigner_d
00288   {
00289   <span class="keyword">private</span>:
00290     <span class="keywordtype">double</span> p,q;
00291     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> sqt;
00292     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> d;
00293     <span class="keywordtype">int</span> n;
00294 
00295     <span class="keywordtype">void</span> do_line0 (<span class="keywordtype">double</span> *l1, <span class="keywordtype">int</span> j)
00296       {
00297       <span class="keywordtype">double</span> xj = 1./j;
00298       l1[j] = -p*l1[j-1];
00299       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=j-1; i&gt;=1; --i)
00300         l1[i] = xj*sqt[j]*(q*sqt[j-i]*l1[i] - p*sqt[i]*l1[i-1]);
00301       l1[0] = q*l1[0];
00302       }
00303     <span class="keywordtype">void</span> do_line (<span class="keyword">const</span> <span class="keywordtype">double</span> *l1, <span class="keywordtype">double</span> *l2, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k)
00304       {
00305       <span class="keywordtype">double</span> xj = 1./j;
00306       <span class="keywordtype">double</span> t1 = xj*sqt[j-k]*q, t2 = xj*sqt[j-k]*p;
00307       <span class="keywordtype">double</span> t3 = xj*sqt[k]*p,   t4 = xj*sqt[k]*q;
00308       l2[j] = sqt[j] * (t4*l1[j-1]-t2*l2[j-1]);
00309       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=j-1; i&gt;=1; --i)
00310         l2[i] = t1*sqt[j-i]*l2[i] - t2*sqt[i]*l2[i-1]
00311                +t3*sqt[j-i]*l1[i] + t4*sqt[i]*l1[i-1];
00312       l2[0] = sqt[j] * (t3*l1[0]+t1*l2[0]);
00313       }
00314 
00315   <span class="keyword">public</span>:
00316     wigner_d(<span class="keywordtype">int</span> lmax, <span class="keywordtype">double</span> ang)
00317       : p(sin(ang/2)), q(cos(ang/2)), sqt(2*lmax+1), d(lmax+1,2*lmax+1), n(-1)
00318       { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;sqt.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a5">size</a>(); ++m) sqt[m] = sqrt(<span class="keywordtype">double</span>(m)); }
00319 
00320     <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> &amp;recurse ()
00321       {
00322       ++n;
00323       <span class="keywordflow">if</span> (n==0)
00324         d[0][0] = 1;
00325       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n==1)
00326         {
00327         d[0][0] = q*q; d[0][1] = -p*q*sqt[2]; d[0][2] = p*p;
00328         d[1][0] = -d[0][1]; d[1][1] = q*q-p*p; d[1][2] = d[0][1];
00329         }
00330       <span class="keywordflow">else</span>
00331         {
00332         <span class="comment">// padding</span>
00333         <span class="keywordtype">int</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a> = (n&amp;1)? -1 : 1;
00334         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=2*n-2; ++i)
00335           {
00336           d[n][i] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a>*d[n-2][2*n-2-i];
00337           <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a>=-sign;
00338           }
00339         do_line (d[n-1],d[n],2*n-1,n);
00340         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=n; k&gt;=2; --k)
00341           {
00342           do_line (d[k-2],d[k-1],2*n-1,k-1);
00343           do_line (d[k-1],d[k],2*n,k);
00344           }
00345         do_line0 (d[0],2*n-1);
00346         do_line (d[0],d[1],2*n,1);
00347         do_line0 (d[0],2*n);
00348         }
00349       <span class="keywordflow">return</span> d;
00350       }
00351   };
00352 
00353 <span class="preprocessor">#else</span>
00354 <span class="preprocessor"></span>
00355 <span class="keyword">class </span>wigner_d
00356   {
00357   <span class="keyword">private</span>:
00358     <span class="keywordtype">double</span> p,q;
00359     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;double&gt;</a> sqt;
00360     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> d, dd;
00361     <span class="keywordtype">int</span> n;
00362 
00363   <span class="keyword">public</span>:
00364     wigner_d(<span class="keywordtype">int</span> lmax, <span class="keywordtype">double</span> ang)
00365       : p(sin(ang/2)), q(cos(ang/2)), sqt(2*lmax+1), d(lmax+1,2*lmax+1),
00366         dd(lmax+1,2*lmax+1), n(-1)
00367       { <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;sqt.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html#a5">size</a>(); ++m) sqt[m] = sqrt(<span class="keywordtype">double</span>(m)); }
00368 
00369     <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> &amp;recurse ()
00370       {
00371       ++n;
00372       <span class="keywordflow">if</span> (n==0)
00373         d[0][0] = 1;
00374       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n==1)
00375         {
00376         d[0][0] = q*q; d[0][1] = -p*q*sqt[2]; d[0][2] = p*p;
00377         d[1][0] = -d[0][1]; d[1][1] = q*q-p*p; d[1][2] = d[0][1];
00378         }
00379       <span class="keywordflow">else</span>
00380         {
00381         <span class="comment">// padding</span>
00382         <span class="keywordtype">int</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a> = (n&amp;1)? -1 : 1;
00383         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;=2*n-2; ++i)
00384           {
00385           d[n][i] = <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a>*d[n-2][2*n-2-i];
00386           <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#ga9">sign</a>=-sign;
00387           }
00388         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=2*n-1; j&lt;=2*n; ++j)
00389           {
00390           <span class="keywordtype">double</span> xj = 1./j;
00391           dd[0][0] = q*d[0][0];
00392           <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1;i&lt;j; ++i)
00393             dd[0][i] = xj*sqt[j]*(q*sqt[j-i]*d[0][i] - p*sqt[i]*d[0][i-1]);
00394           dd[0][j] = -p*d[0][j-1];
00395 <span class="preprocessor">#pragma omp parallel</span>
00396 <span class="preprocessor"></span>{
00397           <span class="keywordtype">int</span> k;
00398 <span class="preprocessor">#pragma omp for schedule(static)</span>
00399 <span class="preprocessor"></span>          <span class="keywordflow">for</span> (k=1; k&lt;=n; ++k)
00400             {
00401             <span class="keywordtype">double</span> t1 = xj*sqt[j-k]*q, t2 = xj*sqt[j-k]*p;
00402             <span class="keywordtype">double</span> t3 = xj*sqt[k  ]*p, t4 = xj*sqt[k  ]*q;
00403             dd[k][0] = xj*sqt[j]*(q*sqt[j-k]*d[k][0] + p*sqt[k]*d[k-1][0]);
00404             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;j; ++i)
00405               dd[k][i] = t1*sqt[j-i]*d[k  ][i] - t2*sqt[i]*d[k  ][i-1]
00406                        + t3*sqt[j-i]*d[k-1][i] + t4*sqt[i]*d[k-1][i-1];
00407             dd[k][j] = -t2*sqt[j]*d[k][j-1] + t4*sqt[j]*d[k-1][j-1];
00408             }
00409 }
00410           dd.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html#a17">swap</a>(d);
00411           }
00412         }
00413       <span class="keywordflow">return</span> d;
00414       }
00415   };
00416 
00417 <span class="preprocessor">#endif</span>
00418 <span class="preprocessor"></span>
00419 } <span class="comment">// namespace</span>
00420 
<a name="l00421"></a><a class="code" href="classAlm.html#m2">00421</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm,
00422   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi)
00423   {
00424   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (alm.Lmax()==alm.Mmax(),
00425     <span class="stringliteral">"rotate_alm: lmax must be equal to mmax"</span>);
00426   <span class="keywordtype">int</span> lmax=alm.Lmax();
00427   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;xcomplex&lt;double&gt;</a> &gt; exppsi(lmax+1), expphi(lmax+1);
00428   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=lmax; ++m)
00429     {
00430     exppsi[m].Set (cos(psi*m),-sin(psi*m));
00431     expphi[m].Set (cos(phi*m),-sin(phi*m));
00432     }
00433 
00434   wigner_d rec(lmax,theta);
00435 
00436   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;xcomplex&lt;double&gt;</a> &gt; almtmp(lmax+1);
00437 
00438   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00439     {
00440     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#a33">announce_progress</a> (pow(<span class="keywordtype">double</span>(l),3),pow(l-1.,3),pow(<span class="keywordtype">double</span>(lmax),3));
00441     <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> &amp;d(rec.recurse());
00442 
00443     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=l; ++m)
00444       almtmp[m] = alm(l,0)*d[l][l+m];
00445 
00446 <span class="preprocessor">#pragma omp parallel</span>
00447 <span class="preprocessor"></span>{
00448     <span class="keywordtype">int</span> lo,hi;
00449     openmp_calc_share(0,l+1,lo,hi);
00450 
00451     <span class="keywordtype">bool</span> flip = <span class="keyword">true</span>;
00452     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mm=1; mm&lt;=l; ++mm)
00453       {
00454       <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> t1 = alm(l,mm)*exppsi[mm];
00455       <span class="keywordtype">bool</span> flip2 = ((mm+lo)&amp;1) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00456       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=lo; m&lt;hi; ++m)
00457         {
00458         <span class="keywordtype">double</span> d1 = flip2 ? -d[l-mm][l-m] : d[l-mm][l-m];
00459         <span class="keywordtype">double</span> d2 = flip  ? -d[l-mm][l+m] : d[l-mm][l+m];
00460         <span class="keywordtype">double</span> f1 = d1+d2, f2 = d1-d2;
00461         almtmp[m].re += t1.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o0">re</a>*f1; almtmp[m].im += t1.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a>*f2;
00462         flip2 = !flip2;
00463         }
00464       flip = !flip;
00465       }
00466 }
00467 
00468     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=l; ++m)
00469       alm(l,m) = almtmp[m]*expphi[m];
00470     }
00471   cout &lt;&lt; endl;
00472   }
00473 
00474 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm,
00475   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi);
00476 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm,
00477   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi);
00478 
<a name="l00479"></a><a class="code" href="classAlm.html#m3">00479</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00480   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00481   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi)
00482   {
00483   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (almT.Lmax()==almT.Mmax(),
00484     <span class="stringliteral">"rotate_alm: lmax must be equal to mmax"</span>);
00485   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/group__assertgroup.html#gga1">planck_assert</a> (almG.conformable(almT) &amp;&amp; almC.conformable(almT),
00486     <span class="stringliteral">"rotate_alm: a_lm are not conformable"</span>);
00487   <span class="keywordtype">int</span> lmax=almT.Lmax();
00488   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;xcomplex&lt;double&gt;</a> &gt; exppsi(lmax+1), expphi(lmax+1);
00489   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=lmax; ++m)
00490     {
00491     exppsi[m].Set (cos(psi*m),-sin(psi*m));
00492     expphi[m].Set (cos(phi*m),-sin(phi*m));
00493     }
00494 
00495   wigner_d rec(lmax,theta);
00496 
00497   <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr.html">arr&lt;xcomplex&lt;double&gt;</a> &gt; almtmpT(lmax+1), almtmpG(lmax+1), almtmpC(lmax+1);
00498 
00499   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> l=0; l&lt;=lmax; ++l)
00500     {
00501     <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/cxxutils_8h.html#a33">announce_progress</a> (pow(<span class="keywordtype">double</span>(l),3),pow(l-1.,3),pow(<span class="keywordtype">double</span>(lmax),3));
00502     <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classarr2.html">arr2&lt;double&gt;</a> &amp;d(rec.recurse());
00503 
00504     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=l; ++m)
00505       {
00506       almtmpT[m] = almT(l,0)*d[l][m+l];
00507       almtmpG[m] = almG(l,0)*d[l][m+l];
00508       almtmpC[m] = almC(l,0)*d[l][m+l];
00509       }
00510 
00511 <span class="preprocessor">#pragma omp parallel</span>
00512 <span class="preprocessor"></span>{
00513     <span class="keywordtype">int</span> lo,hi;
00514     openmp_calc_share(0,l+1,lo,hi);
00515 
00516     <span class="keywordtype">bool</span> flip = <span class="keyword">true</span>;
00517     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> mm=1; mm&lt;=l; ++mm)
00518       {
00519       <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> t1T = almT(l,mm)*exppsi[mm];
00520       <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> t1G = almG(l,mm)*exppsi[mm];
00521       <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> t1C = almC(l,mm)*exppsi[mm];
00522       <span class="keywordtype">bool</span> flip2 = ((mm+lo)&amp;1) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
00523       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=lo; m&lt;hi; ++m)
00524         {
00525         <span class="keywordtype">double</span> d1 = flip2 ? -d[l-mm][l-m] : d[l-mm][l-m];
00526         <span class="keywordtype">double</span> d2 = flip  ? -d[l-mm][l+m] : d[l-mm][l+m];
00527         <span class="keywordtype">double</span> f1 = d1+d2, f2 = d1-d2;
00528         almtmpT[m].re += t1T.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o0">re</a>*f1; almtmpT[m].<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a> += t1T.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a>*f2;
00529         almtmpG[m].<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o0">re</a> += t1G.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o0">re</a>*f1; almtmpG[m].<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a> += t1G.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a>*f2;
00530         almtmpC[m].re += t1C.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o0">re</a>*f1; almtmpC[m].im += t1C.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html#o1">im</a>*f2;
00531         flip2 = !flip2;
00532         }
00533       flip = !flip;
00534       }
00535 }
00536 
00537     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=0; m&lt;=l; ++m)
00538       {
00539       almT(l,m) = almtmpT[m]*expphi[m];
00540       almG(l,m) = almtmpG[m]*expphi[m];
00541       almC(l,m) = almtmpC[m]*expphi[m];
00542       }
00543     }
00544   cout &lt;&lt; endl;
00545   }
00546 
00547 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00548   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00549   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi);
00550 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00551   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00552   <span class="keywordtype">double</span> psi, <span class="keywordtype">double</span> theta, <span class="keywordtype">double</span> phi);
00553 
00554 
<a name="l00555"></a><a class="code" href="classAlm.html#m4">00555</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;alm,
00556   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat)
00557   {
00558   <span class="keywordtype">double</span> a1, a2, a3;
00559   mat.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html#a9">Extract_CPAC_Euler_Angles</a> (a1, a2, a3);
00560   rotate_alm (alm, a3, a2, a1);
00561   }
00562 
00563 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;alm, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat);
00564 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;alm, <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat);
00565 
<a name="l00566"></a><a class="code" href="classAlm.html#m5">00566</a> <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almT,
00567   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;T&gt;</a> &gt; &amp;almC,
00568   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat)
00569   {
00570   <span class="keywordtype">double</span> a1, a2, a3;
00571   mat.<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html#a9">Extract_CPAC_Euler_Angles</a> (a1, a2, a3);
00572   rotate_alm (almT, almG, almC, a3, a2, a1);
00573   }
00574 
00575 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almT,
00576   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;float&gt;</a> &gt; &amp;almC,
00577   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat);
00578 <span class="keyword">template</span> <span class="keywordtype">void</span> rotate_alm (<a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almT,
00579   <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almG, <a class="code" href="classAlm.html">Alm</a>&lt;<a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classxcomplex.html">xcomplex&lt;double&gt;</a> &gt; &amp;almC,
00580   <span class="keyword">const</span> <a class="codeRef" doxygen="cxxsupport.tag:../cxxsupport/" href="../cxxsupport/classrotmatrix.html">rotmatrix</a> &amp;mat);
</pre></div><hr><address style="align: right;"><small>
Generated on Fri Jul 8 09:37:15 2005 for Healpix C++
</a> </small></address>
</body>
</html>
